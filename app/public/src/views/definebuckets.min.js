var DB={_isOn:!1};DB.on=function(){if(!DB._isOn){DB._isOn=!0;var t=function(t){var r=$(t.target),i;r.parent().parent().parent().prev().removeAttr("mode");i=r.parent().parent().find(".pv-facet-order");i.siblings(".pv-facet-value").show();i.siblings(".pv-facet-value-label").off(".db");i.siblings(".pv-facet-value-label").one("contextmenu.db",n);i.remove()},n=function(i){var u=$(i.target),f,s;if(u.hasClass(".pv-facet-value-label")&&(u=u.siblings(".pv-facet-value")),u.parent().parent().parent().prev().attr("mode")!=undefined){u.one("contextmenu.db",n);return!1}u.off("contextmenu.db");u.parent().parent().parent().prev().attr("mode","db");var r=u.parent().parent().find(".pv-facet-value"),o=r.filter(".pv-facet-value:checked"),e="<select class='pv-facet-order'><option value='-1'>--";for(f=1,s=r.length>9?9:r.length;f<=s;f++)e+="<option value='"+f+"'>"+f;e+="<\/select>";r.after(e);o.length==0?r.siblings(".pv-facet-order").val(1):o.siblings(".pv-facet-order").val(1);r.hide();r.siblings(".pv-facet-value-label").off("contextmenu.db");r.siblings(".pv-facet-order").on("contextmenu.db",function(n){return t(n),PV.filterViews(),!1});r.siblings(".pv-facet-value-label").bindFirst("click.db",function(n){var t=$(this).siblings().filter(".pv-facet-order");t.val()==-1?t.val(1):t.val(-1);n.stopImmediatePropagation();t.change()});r.siblings(".pv-facet-order").change(function(){var n=$(this),t=n.parent().parent().find(".pv-facet-value:checked");t.length==0?(n.val()==-1&&(n.parent().siblings().find(".pv-facet-value").prop("checked",!0),PV.filterCollection()),PV.filterCollection()):n.val()==-1&&n.siblings(".pv-facet-value:checked").length!=0?n.siblings(".pv-facet-value").click():n.val()!=-1&&n.siblings(".pv-facet-value:checked").length==0?n.siblings(".pv-facet-value").click():PV.filterCollection()});r.siblings(".pv-facet-value-label").one("contextmenu.db",function(n){return t(n),PV.filterViews(),!1});return PV.filterViews(),!1},r=function(n){var t=$(n.target),r;t.hasClass("ui-slider-handle")&&(t=t.parent());t.parent().parent().prev().removeAttr("mode");t.off(".db");r=t.modSlider("option","values");t.modSlider("option","values",[r[0],r[r.length-1]]);t.modSlider("option","range",!0);t.parent().find(".pv-facet-numericslider-range-val").text(r[0]+" - "+r[r.length-1]);t.modSlider("option","slide",function(n,t){$(this).parent().find(".pv-facet-numericslider-range-val").text(t.values[0]+" - "+t.values[t.values.length-1])});t.one("contextmenu.db",i)},i=function(){var n=$(this);if(n.parent().parent().prev().attr("mode")!=undefined){n.one("contextmenu.db",i);return!1}n.parent().parent().prev().attr("mode","db");n.modSlider("option","range",!1);n.off("contextmenu.db");n.one("contextmenu.db",function(n){return r(n),PV.filterViews(),!1});n.bindFirst("mousedown.db",function(n){var t,f,i,u,r;if(n.which!=1)return!1;if(!n.target||!$(n.target).hasClass("ui-slider-handle")){for(t=$(this),f=(n.pageX-t.offset().left)*(t.modSlider("option","max")-t.modSlider("option","min"))/t.width()+t.modSlider("option","min"),t.modSlider("addValue",f),i=t.modSlider("option","values"),u=i[0],r=1;r<i.length;r++)u+=" - "+i[r];$(this).parent().find(".pv-facet-numericslider-range-val").text(u);n.stopImmediatePropagation();PV.filterViews()}});n.on("mousedown.db",".ui-slider-handle",function(n){if(n.which!=1)return!1;var t=$(this);t.hasClass("ui-slider")?n.target&&$(n.target).hasClass("ui-slider-handle")&&$(n.target).attr("startx",n.pageX):t.attr("startx",n.pageX)});return n.modSlider("option","slide",function(n,t){var e=$(this),i=t.values.indexOf(t.value),f=e.modSlider("option","step"),u,r;if(i<t.values.length-1&&t.value>=t.values[i+1]-f||i>0&&t.value<=t.values[i-1]+f)return!1;for(u=t.values[0],r=1;r<t.values.length;r++)u+=" - "+t.values[r];$(this).parent().parent().find(".pv-facet-numericslider-range-val").text(u)}),n.bindFirst("mouseup.db",".ui-slider-handle",function(n){var t,f,i,r,e,u;if(n.which!=1)return!1;if(t=$(this),t.hasClass("ui-slider")?n.target&&$(n.target).hasClass("ui-slider-handle")&&(t=$(n.target)):t=$(this),f=t.parent().children(".ui-slider-handle"),i=f.index(t),t.attr("startx")&&n.pageX-t.attr("startx")==0&&i>=0&&i<f.length-1){for(t.parent().modSlider("removeValue",i),r=t.parent().modSlider("option","values"),e=r[0],u=1;u<r.length;u++)e+=" - "+r[u];$(this).parent().parent().find(".pv-facet-numericslider-range-val").text(e);PV.filterViews()}}),PV.filterViews(),!1};$(".pv-facet-value").each(function(){var t=$(this),i=PivotCollection.getCategoryByName(t.parent().parent().parent().prev().children("a").attr("title"));if(!i.isDateTime()){t.one("contextmenu.db",n);t.siblings(".pv-facet-value-label").on("contextmenu.db",n)}});$(".pv-facet-numericslider").each(function(){var n=$(this);n.one("contextmenu.db",i)});$(".pv-facet").on("click.db",function(){var t=$(this),r=PivotCollection.getCategoryByName(t.children("a").attr("title"));r.isDateTime()||(r.isNumber()||r.isOrdinal()?t.next().find(".pv-facet-numericslider").each(function(){var n=$(this);n.off("contextmenu.db");n.one("contextmenu.db",i)}):t.next().find(".pv-facet-value").each(function(){var t=$(this);t.off("contextmenu.db");t.one("contextmenu.db",n);t.siblings(".pv-facet-value-label").off("contextmenu.db");t.siblings(".pv-facet-value-label").one("contextmenu.db",n)}))});$(".pv-filterpanel-clearall").bindFirst("click.db",function(){var n=$(".pv-facet[mode='db']");n.next().find("li:first-of-type").find(".pv-facet-order").each(function(n,i){t({target:i})});n.next().find(".pv-facet-numericslider").each(function(n,t){r({target:t})})});$(".pv-filterpanel-accordion-heading-clear").bindFirst("click.db",function(){var n=$(this);n.parent().attr("mode")=="db"&&(n.parent().next().find(".pv-facet-order").eq(0).each(function(n,i){t({target:i})}),n.parent().next().find(".pv-facet-numericslider").each(function(n,t){r({target:t})}))});DB._stopSlider=PV._stopSlider;PV._stopSlider=function(n,t,i,r){var u=n.modSlider("option","values"),f=u.indexOf(r.value);!n.attr("mode")=="db"||f==0||f==u.length-1?DB._stopSlider(n,t,i,r):PV.filterCollection()}}};DB.off=function(){DB._isOn&&(DB._isOn=!1,$(".pv-facet").off("click.db"),$(".pv-facet-value").off("contextmenu.db"),$(".pv-facet-value-label").off("contextmenu.db"),$(".pv-facet-order").remove(),$(".pv-facet[mode='db']").removeAttr(mode),$(".pv-facet-numericslider").off("contextmenu.db"),$(".pv-facet-numericslider").off("click.db"),$(".pv-facet-numericslider").off("mousedown.db"),PV._stopSlider=DB._stopSlider,$(".pv-filterpanel-clearall").off("click.db"),$(".pv-filterpanel-accordion-heading-clear").off("click.db"),PV.filterViews())};DB.isOn=function(){return DB._isOn};DB.isDB=function(n){typeof n=="object"&&(n=n.name);var t=$(".pv-facet[facet='"+PV.cleanName(n.name.toLowerCase())+"']");return t.attr("mode")=="db"};DB.getBuckets=function(n){var e,r,i,o,t,u,f;if(typeof n=="string"&&(n=PivotCollection.getCategoryByName(n)),e=$(".pv-facet[facet='"+PV.cleanName(n.name.toLowerCase())+"']"),e.attr("mode")!="db")return null;if(r=[],n.isNumber())for(i=e.next().find(".pv-facet-numericslider").modSlider("option","values"),t=0;t<i.length-1;t++)r[t]=new PivotViewer.Models.Bucket(i[t],n.getValueLabel(i[t]),i[t+1],n.getValueLabel(i[t+1]));else if(n.isOrdinal()){for(i=e.next().find(".pv-facet-numericslider").modSlider("option","values"),t=0;t<i.length-2;t++)r[t]=new PivotViewer.Models.Bucket(i[t],n.getValueLabel(i[t]),i[t+1],n.getValueLabel(i[t+1]-1));r[t]=new PivotViewer.Models.Bucket(i[t],n.getValueLabel(i[t]),i[t+1],n.getValueLabel(i[t+1]))}else{for(r.values=[],o=e.next().find("li"),t=0;t<o.length;t++)(u=o.eq(t).find(".pv-facet-order").val()-1,u<0)||(f=o.eq(t).find(".pv-facet-value-label").text(),r[u]==undefined?r[u]=new PivotViewer.Models.Bucket(f,f):r[u].endRange=r[u].endLabel=f,r.values[f]=u,r[u].addValue(f));for(t=0;t<r.length;t++)r[t]==undefined&&(r[t]=new PivotViewer.Models.Bucket(null,"empty"))}return r};