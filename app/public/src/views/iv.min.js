var IV={_isOn:!1,count:0};IV.on=function(){if(!IV._isOn){IV._isOn=!0;var n=function(){var n=$(this),i=PivotCollection.getCategoryByName(PV.uncleanName(n.attr("facet"))),t,r,u;return i.isDateTime()?!1:n.attr("mode")=="iv"?(n.find(".pv-iv-code").remove(),i.doFilter=!0,n.children().css("color","black"),n.removeAttr("mode"),n.next().find(".pv-facet-value").show(),n.next().find(".pv-facet-iv").remove(),n.next().find(".pv-facet-value-label").css("color","black"),t=n.next().find(".pv-facet-numericslider"),t.modSlider("values",[t.modSlider("option","min"),t.modSlider("option","max")]),t.parent().find(".pv-facet-numericslider-range-val").text(t.modSlider("option","min")+" - "+t.modSlider("option","max")),$.publish("/PivotViewer/Views/IVFiltered"),!1):n.attr("mode")!=undefined||n.next().find(".pv-facet-value:checked").length!=0?!1:(n.find("a").append(" <span class='pv-iv-code'>("+String.fromCharCode(65+IV.count++)+")<\/span>"),n.attr("mode","iv"),n.children().css("color","blue"),i=PivotCollection.getCategoryByName(PV.uncleanName(n.attr("facet"))),i.uiInit||PV.initUICategory(i),i.doFilter=!1,r=n.next().find(".pv-facet-value"),u=r.next(),r.next().css("color","blue"),r.each(function(){$(this).after("<input type='checkbox' class='pv-facet-iv' itemvalue='"+$(this).attr("itemvalue")+"'>");$(this).next().click(function(){clickValue(this)})}),r.hide(),$.publish("/PivotViewer/Views/IVFiltered"),!1)};IV.clickValue=PV.clickValue;PV.clickValue=function(n){$(n).parent().parent().parent().prev().attr("mode")!="iv"?IV.clickValue(n):$.publish("/PivotViewer/Views/IVFiltered")};IV._stopSlider=PV._stopSlider;PV._stopSlider=function(n,t,i,r){n.parent().parent().prev().attr("mode")!="iv"?IV._stopSlider(n,t,i,r):$.publish("/PivotViewer/Views/IVFiltered")};$(".pv-facet").on("contextmenu.iv",n)}};IV.off=function(){if(IV._isOn){IV._isOn=!1;var n=$(".pv-facet[mode='iv']");n.each(function(){PivotCollection.getCategoryByName(PV.uncleanName($(this).attr("facet"))).doFilter=!0});n.find(".pv-iv-code").remove();n.children().css("color","black");n.next().find(".pv-facet-value-label").css("color","black");$(".pv-facet").off("contextmenu.iv");n.next().find(".pv-facet-value").show();n.next().find(".pv-facet-iv").remove();n.next().find(".pv-facet-numericslider").each(function(){var n=$(this);n.parent().find(".pv-facet-numericslider-range-val").text(n.modSlider("option","min")+" - "+n.modSlider("option","max"));n.modSlider("values",[n.modSlider("option","min"),n.modSlider("option","max")])});n.removeAttr("mode");PV.clickValue=IV.clickValue;PV._sliderStop=IV._sliderStop}};IV.isOn=function(){return IV._isOn};IV.isIV=function(n){typeof n=="object"&&(n=n.name);var t=$(".pv-facet[facet='"+PV.cleanName(n.toLowerCase())+"']");return t.attr("mode")=="iv"};IV.getIV=function(){for(var r,u,f,e,o,i=$(".pv-facet[mode='iv']"),s=[],t=[],n=0;n<i.length;n++)if(r=PivotCollection.getCategoryByName(PV.uncleanName(i.eq(n).attr("facet"))),r.ivCode=i.eq(n).find(".pv-iv-code").html().charAt(1),s.push(r),t.push([]),r.isString())for(u=i.next().find(".pv-facet-iv:checked"),u.length==0&&(u=i.next().find(".pv-facet-iv")),f=0;f<u.length;f++)e=PV.uncleanName(u.eq(f).attr("itemvalue")),t[n][e]=!0,t[n].push(e);else o=$("#pv-facet-numericslider-"+PV.cleanName(r.name)).modSlider("option","values"),t[n].push(o[0]),t[n].push(o[1]);return{categories:s,values:t}};