PivotViewer.Views.TableView=PivotViewer.Views.IPivotViewerView.subClass({init:function(){this._super();this.filter=null;this.selectedFacet=null;this.sortKey="pv-key";this.sortReverse=!1;this.sortReverseEntity=!1;this.sortReverseAttribute=!1;this.sortReverseValue=!1},Setup:function(n,t,i,r){this.width=n;this.height=t;this.offsetX=i;this.offsetY=r;this.currentWidth=this.width;this.currentHeight=this.height;this.currentOffsetX=this.offsetX;this.currentOffsetY=this.offsetY;$(".pv-viewpanel").append("<div class='pv-tableview-table' id='pv-table'><\/div>");$(".pv-viewpanel").append("<div style='visibility:hidden;position:relative;' id='pv-table-loader'><img src='images/loading.gif'><\/img><\/div>");$("#pv-table-loader").css("top",this.height/2-33+"px");$("#pv-table-loader").css("left",this.width/2-43+"px")},Filter:function(n,t){this.tiles=n;this.filter=t;this.sortReverse=!1;this.sortReverseEntity=!1;this.sortReverseAttribute=!1;this.sortReverseValue=!1;this.CreateTable(t,this.selectedFacet,this.sortKey,this.sortReverse);this.filtered=!1},Activate:function(){Modernizr.canvas&&(this._super(),Debug.Log("Table View Filtered: "+this.filterEvt.filter.length),$(".pv-toolbarpanel-sort").fadeIn(),$(".pv-toolbarpanel-zoomcontrols").css("border-width","0"),$("#MAIN_BODY").css("overflow","auto"),$(".pv-tableview-table").fadeIn(),this.filtered&&this.Filter(this.filterEvt.tiles,this.filterEvt.filter))},Deactivate:function(){this._super();$(".pv-tableview-table").fadeOut();$(".pv-toolbarpanel-sort").fadeOut()},GetButtonImage:function(){return"images/TableView.png"},GetButtonImageSelected:function(){return"images/TableViewSelected.png"},GetViewName:function(){return"Table View"},CellClick:function(n,t){var i,f,r,u;Debug.Log("CellClick");n=="pv-key"?(i=t[0].attributes.getNamedItem("itemid").value,this.selected==null||i!=this.selected.facetItem.Id?(f=TileController.GetTileById(i),$.publish("/PivotViewer/Views/Item/Selected",[{item:f,bkt:0}])):i==this.selected.facetItem.Id&&$.publish("/PivotViewer/Views/Item/Selected",[{item:null,bkt:0}])):n=="pv-facet"?(r=this.selected==null?this.filter:[this.selected],this.selectedFacet==""||this.selectedFacet==null?(this.selectedFacet=t[1].textContent.trim(),this.CreateTable(r,this.selectedFacet,this.sortKey)):(this.selectedFacet="",this.CreateTable(r,"")),$.publish("/PivotViewer/Views/Item/Updated",null)):n=="pv-value"&&(u=t[2].attributes.getNamedItem("value").value,$.publish("/PivotViewer/Views/Item/Filtered",[{Facet:t[1].textContent.trim(),Item:u,MaxRange:u,Values:null}]))},CreateTable:function(n,t,i,r){var a=this,nt=$("#pv-table"),b=!1,s=[],k,g,o,y,h,c,d,w,v,p,u,l,e,tt,f;for(nt.empty(),(t==null||t==""||t==undefined)&&(b=!0),$(".pv-tableview-table").css("height",this.height-12+"px"),$(".pv-tableview-table").css("width",this.width-415+"px"),k=r?"images/sort-up.png":"images/sort-down.png",o="odd-row",y="<table id='pv-table-data' style='color:#484848;'><tr class='pv-tableview-heading'><th id='pv-key' title='Sort on subject name'>Subject",i=="pv-key"&&(y+=" <img style='position:relative;top:"+g+"' src='"+k+"'><\/img>"),y+="<\/th><th id='pv-facet' title='Sort on predicate name'>Predicate",i=="pv-facet"&&(y+=" <img style='position:relative;top:"+g+"' src='"+k+"'><\/img>"),y+="<\/th><th id='pv-value' title='Sort on object'>Object",i=="pv-value"&&(y+=" <img style='position:relative;top:"+g+"' src='"+k+"'><\/img>"),y+="<\/th><\/tr>",f=0;f<n.length;f++)if(h=n[f].facetItem.Name,c=n[f].facetItem.Id,b||t=="Description"){if(i=="pv-key"?e=h:i=="pv-facet"?e="Description":i=="pv-value"&&(e=n[f].facetItem.Description),n[f].facetItem.Description&&(n[f].facetItem.Href?s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"' title='Toggle item selection' style='color:#009933;cursor:pointer'>"+h+" <a href="+n[f].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/a><\/td><td id='pv-facet' title='Show only this predicate' style='color:#009933;cursor:pointer'>Description<\/td><td id='pv-value'>"+n[f].facetItem.Description+"<\/td><\/tr>"}):s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"' class='tooltip' title='Toggle item selection'>"+h+"<\/td><td id='pv-facet' title='Show only this predicate' style='color:#009933;cursor:pointer'>Description<\/td><td id='pv-value'>"+n[f].facetItem.Description+"<\/td><\/tr>"}),o="even-row"),o=o=="odd-row"?"even-row":"odd-row",b)for(d=0;d<n[f].facetItem.Facets.length;d++)for(w=n[f].facetItem.Facets[d],v=w.Name,p=0;p<w.FacetValues.length;p++)u=w.FacetValues[p].Value,l=w.FacetValues[p].Label,i=="pv-key"?e=h:i=="pv-facet"?e=v:i=="pv-value"&&(e=u),PivotCollection.GetFacetCategoryByName(v).IsFilterVisible?n[f].facetItem.Href?this.IsUri(u)?s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Toggle item selection' style='color:#009933;cursor:pointer'>"+h+" <a href="+n[f].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/td><td id='pv-facet'  title='Show only this predicate' style='color:#009933;cursor:pointer'>"+v+"<\/td><td id='pv-value' value='"+u+"' title='Filter on this value' style='color:#009933;cursor:pointer'>"+l+" <a href="+u+" target=\"_blank\"><img style='cursor:default;' id=pv-linkout' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/td><\/tr>"}):s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Toggle item selection' style='color:#009933;cursor:pointer'>"+h+" <a href="+n[f].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/td><td id='pv-facet'  title='Show only this predicate' style='color:#009933;cursor:pointer'>"+v+"<\/td><td id='pv-value' value='"+u+"' title='Filter on this value' style='color:#009933;cursor:pointer'>"+l+"<\/td><\/tr>"}):this.IsUri(u)?s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Toggle item selection'>"+h+"<\/td><td id='pv-facet'  title='Show only this predicate' style='color:#009933;cursor:pointer'>"+v+"<\/td><td id='pv-value' value='"+u+"' title='Filter on this value' style='color:#009933;cursor:pointer'>"+l+" <a href='"+u+"' target=\"_blank\"><img style='cursor:default;' id=pv-linkout' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/td><\/tr>"}):s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Toggle item selection'>"+h+"<\/td><td id='pv-facet'  title='Show only this predicate' style='color:#009933;cursor:pointer'>"+v+"<\/td><td id='pv-value' value='"+u+"' title='Filter on this value' style='color:#009933;cursor:pointer'>"+l+"<\/td><\/tr>"}):n[f].facetItem.Href?this.IsUri(u)?s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Toggle item selection' style='color:#009933;cursor:pointer'>"+h+" <a href="+n[f].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/td><td id='pv-facet' title='Show only this predicate' style='color:#009933;cursor:pointer'>"+v+"<\/td><td id='pv-value' value='"+u+"'><a href='"+u+"' target='_blank'>"+l+"<\/a><\/td><\/tr>"}):s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Toggle item selection' style='color:#009933;cursor:pointer'>"+h+" <a href="+n[f].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/td><td id='pv-facet' title='Show only this predicate' style='color:#009933;cursor:pointer'>"+v+"<\/td><td id='pv-value' value='"+u+"'>"+l+"<\/td><\/tr>"}):this.IsUri(u)?s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Select this value'>"+h+"<\/td><td id='pv-facet' title='Show only this predicate' style='color:#009933;cursor:pointer'>"+v+"<\/td><td id='pv-value' value='"+u+"'><a href='"+u+"' target='_blank'>"+l+"<\/a><\/td><\/tr>"}):s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Select this value'>"+h+"<\/td><td id='pv-facet' title='Show only this predicate' style='color:#009933;cursor:pointer'>"+v+"<\/td><td id='pv-value' value='"+u+"'>"+l+"<\/td><\/tr>"}),o=o=="odd-row"?"even-row":"odd-row"}else for(w=n[f].facetItem.FacetByName[t],p=0;p<w.FacetValues.length;p++)u=w.FacetValues[p].Value,l=w.FacetValues[p].Label,i=="pv-key"?e=h:i=="pv-facet"?e=t:i=="pv-value"&&(e=u),PivotCollection.GetFacetCategoryByName(t).IsFilterVisible?n[f].facetItem.Href?this.IsUri(u)?s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Toggle item selection' style='color:#009933;cursor:pointer'>"+h+" <a href="+n[f].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/td><td id='pv-facet' title='Clear predicate selection' style='color:#009933;cursor:pointer'>"+t+"<\/td><td id='pv-value' value='"+u+"' title='Filter on this value' style='color:#009933;cursor:pointer'>"+u+" <a href='"+u+"' target=\"_blank\"><img style='cursor:default;' id=pv-linkout' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/td><\/tr>"}):s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Toggle item selection' style='color:#009933;cursor:pointer'>"+h+" <a href="+n[f].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/td><td id='pv-facet' title='Clear predicate selection' style='color:#009933;cursor:pointer'>"+t+"<\/td><td id='pv-value' value='"+u+"' title='Filter on this value' style='color:#009933;cursor:pointer'>"+l+"<\/td><\/tr>"}):this.IsUri(u)?s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Toggle item selection'>"+h+"<\/td><td id='pv-facet' class-'tooltipcustom' title='Clear predicate selection' style='color:#009933;cursor:pointer'>"+t+"<\/td><td id='pv-value' value='"+u+"' title='Filter on this value' style='color:#009933;cursor:pointer'>"+l+" <a href='"+u+"' target='_blank'><img style='cursor:default;' id=pv-linkout' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/td><\/tr>"}):s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Toggle item selection'>"+h+"<\/td><td id='pv-facet' class-'tooltipcustom' title='Clear predicate selection' style='color:#009933;cursor:pointer'>"+t+"<\/td><td id='pv-value' value='"+u+"' title='Filter on this value' style='color:#009933;cursor:pointer'>"+l+"<\/td><\/tr>"}):n[f].facetItem.Href?this.IsUri(u)?s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Click the cell to select this item' style='color:#009933;cursor:pointer'>"+h+" <a href="+n[f].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/td><td id='pv-facet' title='Clear predicate selection' style='color:#009933;cursor:pointer'>"+t+"<\/td><td id='pv-value' value='"+u+"'><a href='"+u+"' target='_blank'>"+l+"<\/a><\/td><\/tr>"}):s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Click the cell to select this item' style='color:#009933;cursor:pointer'>"+h+" <a href="+n[f].facetItem.Href.replace(/'/g,"%27")+" target=\"_blank\"><img style='cursor:default;' id='pv-linkout' title='Follow the link' src='images/goout.gif'><\/img><\/a><\/td><td id='pv-facet' title='Clear predicate selection' style='color:#009933;cursor:pointer'>"+t+"<\/td><td id='pv-value' value='"+u+"'>"+l+"<\/td><\/tr>"}):this.IsUri(u)?s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Toggle item selection'>"+h+"<\/td><td id='pv-facet' class-'tooltipcustom' title='Clear predicate selection' style='color:#009933;cursor:pointer'>"+t+"<\/td><td id='pv-value' value='"+u+"'><a href='"+u+"' target='_blank'>"+l+"<\/a><\/td><\/tr>"}):s.push({key:e,value:"<tr class='pv-tableview-"+o+"'><td id='pv-key' itemid='"+c+"'title='Toggle item selection'>"+h+"<\/td><td id='pv-facet' class-'tooltipcustom' title='Clear predicate selection' style='color:#009933;cursor:pointer'>"+t+"<\/td><td id='pv-value' value='"+u+"'>"+l+"<\/td><\/tr>"}),o=o=="odd-row"?"even-row":"odd-row";if(s.length==0){if(b==!0){tt="There is no data to show about the selected items";$(".pv-wrapper").append('<div id="pv-dztable-error" class="pv-modal-dialog"><div><a href="#pv-modal-dialog-close" title="Close" class="pv-modal-dialog-close">X<\/a><h2>HTML5 PivotViewer<\/h2><p>'+tt+"<\/p><\/div><\/div>");setTimeout(function(){window.open("#pv-dztable-error","_self")},1e3);return}this.CreateTable(n,"",i,r)}else{for(s.sort(function(n,t){return n.key>t.key?1:n.key<t.key?-1:0}),r&&s.reverse(),f=0;f<s.length;f++)y+=s[f].value;y+="<\/table>";nt.append(y);$("#pv-table-data").colResizable({disable:!0});$("#pv-table-data").colResizable({disable:!1});$(".pv-tableview-heading").on("click",function(n){$("#pv-table-loader").show();var t=n.originalEvent.target.id,i;i=a.selected==null?a.filter:[a.selected];t=="pv-key"?a.sortReverse=a.sortReverseEntity:t=="pv-facet"?a.sortReverse=a.sortReverseAttribute:t=="pv-value"&&(a.sortReverse=a.sortReverseValue);a.sortKey=t;a.CreateTable(i,a.selectedFacet,t);$("#pv-table-loader").fadeOut()});$(".pv-tableview-odd-row").on("click",function(n){$("#pv-table-loader").show();var t=n.originalEvent.target.id;a.CellClick(t,n.currentTarget.cells);$("#pv-table-loader").fadeOut()});$(".pv-tableview-even-row").on("click",function(n){$("#pv-table-loader").show();var t=n.originalEvent.target.id;a.CellClick(t,n.currentTarget.cells);$("#pv-table-loader").fadeOut()})}},SetSelected:function(n){this._super(n);n==null?this.CreateTable(this.filter,this.selectedFacet):this.CreateTable([n],this.selectedFacet)},IsUri:function(n){return typeof n=="string"&&(n.substring(0,5)=="http:"||n.substring(0,6)=="https:")?!0:!1}});
