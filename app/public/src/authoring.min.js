authoring_cards=function(e){var t=[],n=[],a=[],r=[],o=[],l="";$("#loader").append(e),$("#pv-modal-text").html('<div id="pv-card"></div><button type=button id="pv-card-previous">Previous</button><button type=submit id="pv-card-submit">Next</button>');var i=[],p=0;i.push(function(){return'Project Name:<p><input id="project-name">'}),i.push(function(){void 0!=$("#project-name").val()&&(e.project=$("#project-name").val());for(var t='Columns to Include:<p><select id="column-select" multiple size=20>',n=e.data[0],a=0;a<n.length;a++)t+="<option value="+a+">"+n[a]+"</option>";return t+="</select>"}),i.push(function(){a=$("#column-select").val()||[],t=[];for(var n=0;n<e.data.length;n++){t.push(new Array);for(var r=0;r<a.length;r++)t[n].push(e.data[n][a[r]])}return'Number of Rows to Include:<br>(Randomly selected if not all)<p><input id="row-select" size=4 maxsize=4 value='+(e.data.length-1)+"> out of "+(t.length-1)}),i.push(function(){r=$("#row-select").val();for(var e=(n=r<t.length-1?permute(t,r):t)[0],a='Name Column:<p><select id="name-column"><option value=-1>Generate Unique ID</option>',o=0;o<e.length;o++)a+="<option value="+o+">"+e[o]+"</option>";return a+="</select>"}),i.push(function(){l=$("#name-column").val();for(var e=n[0],t='Image Categories:<p><select id="class-select" multiple size=20>',a=0;a<e.length;a++)t+="<option value="+a+">"+e[a]+"</option>";return t+="</select>"}),i.push(function(){o=$("#class-select").val();for(var e='<form enctype="multipart/form-data" method="post" id="upload">Image Association:<p>Class Combinations:',t=[],a=0;a<o.length;a++){t[a]={};for(var r=o[a],l=1;l<n.length;l++)t[a].hasOwnProperty(n[l][o[a]])||(t[a][n[l][r]]=!0)}for(var i=1,p=[],u=[],a=0;a<o.length;a++){u[a]=[];l=0;for(var s in t[a])u[a][l++]=s;i*=u[a].length,p[a]=0}for(a=0;a<i;a++){for(var c="",d="",l=0;l<o.length;l++){p[l]==u[l].length&&(p[l]=0,l!=o.length-1&&p[l+1]++);var m=u[l][p[l]];c+="-"+(m=""==m.trim()?"(missing)":m.replace(/[\.\s]/g,"_")),d+=m+" "}p[0]++,e+='<input type=file name="class'+c+'" accept=".jpg,.gif,.png"> '+d+"<br>"}return e+="</form>"}),$("#pv-card").html(i[0]()),$("#pv-card-previous").on("click",function(e){0!=p&&$("#pv-card").html(i[--p]())}),$("#pv-card-submit").on("click",function(t){if(p==i.length-1){for(var a=n[0],r=0;r<a.length;r++){for(var u=1,s=!1;u<n.length;u++)if(""!=n[u][r].trim()){s=!0;var c=moment.parseFormat(n[u][r]);if(-1===c.indexOf("H")&&-1===c.indexOf("M")||-1!==c.indexOf("MMM")||!moment(n[u][r],c).isValid())break}if(s)if(u!=n.length){var d=!0;for(u=1;u<n.length;u++)if(""!=n[u][r].trim()){if(!/(?:-?\d+\.?\d*)|(?:-?\d*\.?\d+)/.test(n[u][r].replace(/,/g,"")))break;d&&((h=parseFloat(n[u][r].replace(/,/g,"").match(/(?:-?\d+\.?\d*)|(?:-?\d*\.?\d+)/)[0]))<0||h>=10||!Number.isInteger(h))&&(d=!1)}u!=n.length||(a[r]+=d?"#ordinal":"#number")}else a[r]+="#date"}n[0].push("#img"),n[0].push("#name");for(u=1;u<n.length;u++){for(var m="class",r=0;r<o.length;r++){var h=n[u][o[r]];""==h.trim()&&(h="(missing)"),m+="-"+h}n[u].push(m.replace(/[\.\s]/g,"_")),-1==l?n[u].push(u):n[u].push(n[u][l])}e.data=n;var f=new FormData($("#upload")[0]);f.append("project",e.project),f.append("data",JSON.stringify(e.data)),$.ajax({url:"upload_new.php",type:"POST",data:f,processData:!1,contentType:!1,success:function(){$.publish("/PivotViewer/Authoring/Completed",null)}})}else $("#pv-card").html(i[++p]())})},permute=function(e,t){var n,a=e.length,r=new Array,o=e.length-t,l=1;for(t>e.length-1&&(t=e.length-1),r[0]=e[0];o!==a;)a--,n=Math.floor(Math.random()*a)+1,r[l++]=e[n],e[n]=e[a];return r};