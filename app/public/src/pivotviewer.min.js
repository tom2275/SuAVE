var PV={},PivotCollection=new PivotViewer.Models.Collection,TileController=null,Loader=null,LoadSem=new Semaphore(1),Settings={showMissing:!1,visibleCategories:void 0},PARA={},timeout=null,_tooltip_item=null,_tooltip_enable=!0,A=[],B=[],D=[],AB=[],AD=[],BD=[],ABD=[],Cs=[],ACs=[],BCs=[],ABCs=[],ADCs=[],BDCs=[],ABDCs=[],ABCs=[],ruleFilters=[],bucketRules=[],ruleNums=0,graphPara={};!function($){function getAllTable(){for(var e=0;e<Cs.length;e++){ACs[e]=[],BCs[e]=[],ABCs[e]=[],ADCs[e]=[],BDCs[e]=[],ABDCs[e]=[];for(var t=0;t<A.length;t++){var a=A[t].getFacetByName(bucketRules[e].name);void 0!=a&&("string"==bucketRules[e].type?bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&ACs[e].push(A[t]):(bucketRules[e].type="nonstring")&&bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&ACs[e].push(A[t]))}for(var t=0;t<B.length;t++){var a=B[t].getFacetByName(bucketRules[e].name);void 0!=a&&("string"==bucketRules[e].type?bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&BCs[e].push(B[t]):(bucketRules[e].type="nonstring")&&bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&BCs[e].push(B[t]))}for(var t=0;t<AB.length;t++){var a=AB[t].getFacetByName(bucketRules[e].name);void 0!=a&&("string"==bucketRules[e].type?bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&ABCs[e].push(AB[t]):(bucketRules[e].type="nonstring")&&bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&ABCs[e].push(AB[t]))}for(var t=0;t<AD.length;t++){var a=AD[t].getFacetByName(bucketRules[e].name);void 0!=a&&("string"==bucketRules[e].type?bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&ADCs[e].push(AD[t]):(bucketRules[e].type="nonstring")&&bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&ADCs[e].push(AD[t]))}for(var t=0;t<BD.length;t++){var a=BD[t].getFacetByName(bucketRules[e].name);void 0!=a&&("string"==bucketRules[e].type?bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&BDCs[e].push(BD[t]):(bucketRules[e].type="nonstring")&&bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&BDCs[e].push(BD[t]))}for(var t=0;t<ABD.length;t++){var a=ABD[t].getFacetByName(bucketRules[e].name);void 0!=a&&("string"==bucketRules[e].type?bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&ABDCs[e].push(ABD[t]):(bucketRules[e].type="nonstring")&&bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&ABDCs[e].push(ABD[t]))}}}var _views=[],_itemTotals=[],_numericItemTotals=[],_ordinalItemTotals=[],_longstringFilters=null,_longStringCategories=[];_stringFilters=[],_numericFilters=[],_datetimeFilters=[],_selectedFilters=[],_currentView=0,_sortCategory=null,_tiles=[],_filterList=[],_selectedItem=null,_imageController=null,_mouseDrag=null,_mouseMove=null,_self=null,_nameMapping=[],_enabledView=[],_options={},_rEnable=!1,_listObj={},1==_options.authoring&&(PARA.y_axis=null,PARA.selected_id=-1);var methods={init:function(e){_self=this,_self.addClass("pv-wrapper"),$(document).on("contextmenu",function(){return!1}),_options=e,$.getJSON("defaults.json").always(function(t){for(var a=Object.keys(t),i=0;i<a.length;i++)void 0==e[a[i]]&&(e[a[i]],t[a[i]]);if(void 0==e.ImageController)_imageController=new PivotViewer.Views.DeepZoomImageController;else{if(!(e.ImageController instanceof PivotViewer.Views.IImageController))throw"Image Controller does not inherit from PivotViewer.Views.IImageController.";_imageController=e.ImageController}_enabledView=e.Views,void 0==e.Loader?($(".pv-wrapper").append("<div id='pv-file-selection' class='pv-modal-dialog modal-lg'><div><div id='pv-modal-text'><p>Use Existing Project:<br><select id='pv-server-file' class='pv-server-file'><option>Select a file</option></select><p>Create New Project:<br><input id='pv-load-file' class='pv-load-file' type=file accept='.csv'></div></div></div>"),$pv_server_file=$("#pv-server-file"),$.getJSON("../project_list.php",function(e){$.each(e,function(e,t){$pv_server_file.append('<option value="'+t+'">'+t+"</option>")})}),$pv_server_file.on("change",function(t){Loader=$pv_server_file.val().endsWith(".cxml")?new PivotViewer.Models.Loaders.CXMLLoader("projects/"+$pv_server_file.val()):new PivotViewer.Models.Loaders.CSVLoader("projects/"+$pv_server_file.val()),PV._initCollectionLoader(e),window.open("#pv-modal-dialog-close","_self")}),$(".pv-load-file").on("change",function(t){var a=$("#pv-load-file")[0];Loader=new PivotViewer.Models.Loaders.LocalCSVLoader(a.files[0]),PV._initCollectionLoader(e)}),window.open("#pv-file-selection","_self")):(Loader=e.Loader,PV._initCollectionLoader(e))}).fail(function(e,t,a){var i=t+", "+a;Debug.log("Getting defaults file failed: "+i)})}};PV._initCollectionLoader=function(e){if(_self.append("<div class='pv-loading'><img src='images/loading.gif' alt='Loading' /><span>Loading...</span></div>"),$(".pv-loading").css("top",$(".pv-wrapper").height()/2-33+"px"),$(".pv-loading").css("left",$(".pv-wrapper").width()/2-43+"px"),void 0==Loader)throw"Collection loader is undefined.";if(!(Loader instanceof PivotViewer.Models.Loaders.ICollectionLoader))throw"Collection loader does not inherit from PivotViewer.Models.Loaders.ICollectionLoader.";e.dzc&&(PivotCollection.imageBase=e.dzc),Loader.loadCollection(PivotCollection)},PV._bucketizeDateTimeFacet=function(e,t,a){var i=["<ul class='pv-filterpanel-accordion-facet-list'>"];if(t)for(var l=0;l<t.length;l++){var n=l+1;i[n]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-"+PV.cleanName(e)+"__"+PV.cleanName(t[l].name.toString())+"'>",i[n]+="<input itemvalue='"+PV.cleanName(t[l].name.toString())+"' itemfacet='"+PV.cleanName(e.toString())+"' startdate='"+t[l].start.toISOString()+"' enddate='"+t[l].end.toISOString()+"' class='pv-facet-value' type='checkbox' />",i[n]+="<span class='pv-facet-value-label'>"+t[l].name+"</span>",i[n]+="<span class='pv-facet-value-count'>0</span>",i[n]+="</li>"}if(i[t.length+1]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-LineBreak' style='border-bottom:thin solid #E2E2E2;'></li>",i[t.length+2]="</ul>",i[t.length+3]="<ul class='pv-filterpanel-accordion-facet-list'>",a)for(var l=0;l<a.length;l++){var n=l+4+t.length;i[n]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-"+PV.cleanName(e)+"__"+PV.cleanName(a[l].name.toString())+"'>",i[n]+="<input itemvalue='"+PV.cleanName(a[l].name.toString())+"' itemfacet='"+PV.cleanName(e.toString())+"' startdate='"+a[l].start.toISOString()+"' enddate='"+a[l].end.toISOString()+"' class='pv-facet-value' type='checkbox' />",i[n]+="<span class='pv-facet-value-label'>"+a[l].name+"</span>",i[n]+="<span class='pv-facet-value-count'>0</span>",i[n]+="</li>"}else a=[];return i[t.length+a.length+4]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-LineBreak2' style='border-bottom:thin solid #E2E2E2;'></li>",i[t.length+a.length+5]="</ul>",i.join("")},PV._createCustomRange=function(e){var t=["<ul class='pv-filterpanel-accordion-facet-list'>"];return t[1]="<li class='pv-filterpanel-accordion-facet-list-item'  id='pv-facet-value-"+PV.cleanName(e)+"__CustomRange'>",t[1]+="<input itemvalue='CustomRange' itemfacet='"+PV.cleanName(e)+"' class='pv-facet-value' type='checkbox' />",t[1]+="<span class='pv-facet-value-label'>Custom Range</span>",t[1]+="</li>",t[1]+="<ul class='pv-filterpanel-accordion-facet-list'>",t[1]+="<li class='pv-filterpanel-accordion-facet-list-item' id='pv-custom-range-"+PV.cleanName(e)+"__Start' style='visibility:hidden;float:right'>",t[1]+="<span class='pv-facet-customrange-label'>Start:</span>",t[1]+="<input itemvalue='CustomRangeStart' itemfacet='"+PV.cleanName(e)+"' id='pv-custom-range-"+PV.cleanName(e)+"__StartDate' class='pv-facet-customrange' type='text'/>",t[1]+="</li>",t[1]+="<li class='pv-filterpanel-accordion-facet-list-item' id='pv-custom-range-"+PV.cleanName(e)+"__Finish' style='visibility:hidden;float:right'>",t[1]+="<span class='pv-facet-customrange-label'>End:</span>",t[1]+="<input itemvalue='CustomRangeFinish' itemfacet='"+PV.cleanName(e)+"' id='pv-custom-range-"+PV.cleanName(e)+"__FinishDate' class='pv-facet-customrange' type='text'/>",t[1]+="</li>",t[t.length]="</ul>",t.join("")},PV._createDatetimeNoInfoFacet=function(e){var t=_itemTotals[e];if(void 0==t)return"";var a=t["(no info)"],i="<ul class='pv-filterpanel-accordion-facet-list'>";return void 0!=a&&(i+="<li class='pv-filterpanel-accordion-facet-list-item'  id='"+a.id+"'>",i+="<input itemvalue='"+PV.cleanName(a.value)+"' itemfacet='"+PV.cleanName(e)+"' class='pv-facet-value' type='checkbox' />",i+="<span class='pv-facet-value-label'>"+a.value+"</span>",i+="<span class='pv-facet-value-count'>0</span>",i+="</li>"),i+="<li class='pv-filterpanel-accordion-facet-list-item'  style='border-bottom:thin solid #E2E2E2;'></li>",i+="</ul>"},PV._createStringFilters=function(e){var t=["<ul class='pv-filterpanel-accordion-facet-list list'>"],a=_itemTotals[e],i=1;for(var l in a.values){var n=a.values[l];t[i]="<li class='pv-filterpanel-accordion-facet-list-item'  id='"+n.id+"'>",t[i]+="<input itemvalue='"+PV.cleanName(n.value)+"' itemfacet='"+PV.cleanName(e)+"' class='pv-facet-value' type='checkbox' />",t[i]+="<span class='pv-facet-value-label'>"+n.value+"</span>",t[i]+="<span class='pv-facet-value-count'>0</span>",t[i++]+="</li>"}return t[t.length]="</ul>",t.join("")+'<ul class="pagination"></ul>'},PV._refreshSliderWidget=function(e,t,a){var i=PivotViewer.Utils.escapeMetaChars(PV.cleanName(e.name)),l=$("#pv-filterpanel-category-numberitem-"+i),n=void 0==l.attr("created");n&&l.append("<span class='pv-facet-numericslider-range-val'>&nbsp;</span><br>"),l.find("svg").remove();for(var o=a(t),r="<svg class='pv-filterpanel-accordion-facet-chart' width='165' height='80'>",s=.5+165/o.histogram.length|0,v=o.histogram.length>1?Math.max.apply(null,o.histogram):1,c=0;c<o.histogram.length;c++){var p=.5+80/v*o.histogram[c];r+="<rect x='"+(.5+s*c|0)+"' y='"+(80-p)+"' width='"+s+"' height='"+p+"'></rect>"}if(l.find("br").after(r+"</svg>"),n){var u=e.getValueLabel(o.min),d=e.getValueLabel(o.max);l.append("<div id='pv-facet-numericslider-"+i+"' class='pv-facet-numericslider'></div><table width=100%><tr><td class='pv-facet-numericslider-range-min'>"+u+"</td><td align=right class='pv-facet-numericslider-range-max'>"+d+"</td></tr></table>"),l.attr("created",1)}var m=$("#pv-facet-numericslider-"+i),g=o.max-o.min;n&&m.modSlider({values:[o.min,o.max]}),m.modSlider("option","min",o.min),m.modSlider("option","max",o.max),m.modSlider("option","step",g<10&&!e.integer?g/o.histogram.length:1),n&&(m.modSlider("option","range",!0),m.modSlider("option","start",function(e,t){this.startMin=t.values[0],this.startMax=t.values[t.values.length-1]}),m.modSlider("option","slide",function(t,a){var i=e.getValueLabel(a.values[0]),l=e.getValueLabel(a.values[a.values.length-1]);$(this).parent().find(".pv-facet-numericslider-range-val").text(i+" - "+l)}),m.modSlider("option","stop",function(t,a){PV._stopSlider($("#pv-facet-numericslider-"+i),e,t,a)}));var f="#pv-facet-numericslider-"+i;$(f).next("table").find(".pv-facet-numericslider-range-min").html(e.getValueLabel(o.min)),$(f).next("table").find(".pv-facet-numericslider-range-max").html(e.getValueLabel(o.max)),m.modSlider("updateValues",[Math.min.apply(null,t),Math.max.apply(null,t)])},PV._refreshNumberWidget=function(e,t){PV._refreshSliderWidget(e,t,PivotViewer.Utils.getHistogram)},PV._refreshOrdinalWidget=function(e,t){PV._refreshSliderWidget(e,t,PivotViewer.Utils.getOrdinalHistogram)},PV._stopSlider=function(e,t,a,i){var e=$("#pv-facet-numericslider-"+PV.cleanName(t.name)),l=e.modSlider("option","min"),n=e.modSlider("option","max");if(i.values[0]>l||i.values[i.values.length-1]<n)e.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible");else if(i.values[0]==l&&i.values[i.values.length-1]==n&&(e.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden"),void 0==_numericFilters[t.name]))return;PV.filterCollection({category:t,enlarge:e[0].startMin>i.values[0]||e[0].startMax<i.values[i.values.length-1],min:i.values[0],max:i.values[i.values.length-1],rangeMin:l,rangeMax:n})},PV.selectView=function(e){var t;if("string"==typeof e||e instanceof String){for(var a=0;a<_views.length;a++)if(_views[a].getViewName().toLowerCase().startsWith(e.toLowerCase())){t=a;break}}else t=e;PV.deselectInfoPanel(),PV.getCurrentView().handleClick({type:"clear"}),$("#pv-viewpanel-view-"+_currentView+"-image").attr("src",_views[_currentView].getButtonImage()),_views[_currentView].deactivate(),$("#pv-viewpanel-view-"+t+"-image").attr("src",_views[t].getButtonImageSelected()),_views[t].activate(),_currentView=t,1==_currentView&&PV.getBucketFilters();var i=_views[t].getViewName().toLowerCase();1==_options.authoring&&(PV.getGraphParameters(),PARA.view=i.substr(0,i.indexOf("view")-1),"crosstab"!=PARA.view?PARA.y_axis=null:PARA.y_axis=$("#pv-altsort option:selected").html())},PV.getCurrentView=function(){return _views[_currentView]},PV.filterViews=function(){for(var e=0;e<_views.length;e++)_views[e].handleFilter(_tiles,_filterList,_sortCategory);void 0!=_views[1]&&(PV.getBucketFilters(),PV.getRuleFilters(),!0===_options.authoring&&PV.getGraphParameters())},PV.getGraphParameters=function(){graphPara={};var e=_views[_currentView].getViewName().toLowerCase();if(graphPara.view=e.substr(0,e.indexOf("view")-1),"map"==graphPara.view)graphPara.mData=[],setTimeout(function(){for(var e=_views[_currentView].filterList,t=0;t<e.length;t++)e[t].loc&&graphPara.mData.push([e[t].loc.lat,e[t].loc.lng])},2e3);else if("grid"==graphPara.view)graphPara.x=$("#pv-primsort option:selected").html(),graphPara.gSize=_views[_currentView].filterList.length;else if(_views[_currentView].buckets&&!_views[_currentView].bucketsY){graphPara.x=$("#pv-primsort option:selected").html(),graphPara.xData=[];for(var t=_views[_currentView].buckets,a=0;a<t.length;a++){var i=[];t[a].startRange==t[a].endRange?i.push(t[a].endLabel):i.push(t[a].startLabel+" to "+t[a].endLabel),i.push(t[a].tiles.length),graphPara.xData.push(i)}t=[]}else if(_views[_currentView].bucketsY){graphPara.x=$("#pv-primsort option:selected").html(),graphPara.y=$("#pv-altsort option:selected").html(),graphPara.yData=[];var t=_views[_currentView].buckets;graphPara.xSize=t.length,graphPara.ySize=t[0].subBuckets.length,graphPara.xLabels=[],graphPara.yLabels=[];for(var a=0;a<graphPara.xSize;a++)for(var l=0;l<graphPara.ySize;l++){var i=[];t[a].startRange==t[a].endRange?i.push(t[a].endLabel):i.push(t[a].startLabel+" to "+t[a].endLabel),t[a].subBuckets[l].startRange==t[a].subBuckets[l].endRange?i.push(t[a].subBuckets[l].endLabel):i.push(t[a].subBuckets[l].startLabel+" to "+t[a].subBuckets[l].endLabel),i.push(t[a].subBuckets[l].tiles.length),graphPara.yData.push(i)}t=[]}else graphPara.x=$("#pv-primsort option:selected").html()},PV.getBucketFilters=function(){bucketRules=[];var e;e=PivotCollection.getCategoryByName(_sortCategory).isString()||PivotCollection.getCategoryByName(_sortCategory).isLocation()?"string":"nonstring";for(var t=_views[1].buckets,a=0;a<t.length;a++)if("string"==e){var i=[t[a].startRange,t[a].endRange];bucketRules.push({name:_sortCategory,type:e,value:i})}else{var i=[t[a].startRange,t[a].endRange];bucketRules.push({name:_sortCategory,type:e,value:i})}void 0!=bucketRules&&PV.getBucketsCount()},PV.getBucketsCount=function(){Cs=[];for(var e=0;e<bucketRules.length;e++){Cs[e]=[];for(var t=0;t<PivotCollection.items.length;t++)if("string"==bucketRules[e].type){var a=PivotCollection.items[t].getFacetByName(bucketRules[e].name);void 0!=a&&bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&Cs[e].push(PivotCollection.items[t])}else if(bucketRules[e].type="nonstring"){var a=PivotCollection.items[t].getFacetByName(bucketRules[e].name);void 0!=a&&bucketRules[e].value[0]<=a.values[0].value&&bucketRules[e].value[1]>=a.values[0].value&&Cs[e].push(PivotCollection.items[t])}}},PV.getRuleFilters=function(){ruleFilters=[],ruleNums=0;for(var e=0;e<_stringFilters.length;e++){ruleNums++;for(var t=_stringFilters[e].facet,a="string",i=[],l=0;l<_stringFilters[e].value.length;l++)i.push(_stringFilters[e].value[l]);ruleFilters.push({name:t,type:a,value:i})}for(var e=0;e<_numericFilters.length;e++){ruleNums++;var t=_numericFilters[e].facet,a="nonstring",n=_numericFilters[e].selectedMax,o=_numericFilters[e].selectedMin;ruleFilters.push({name:t,type:a,value:[o,n]})}PV.ruleCount()},PV.ruleCount=function(){if(!(0==ruleNums||ruleNums>3)){A=[],B=[],D=[],AB=[],AD=[],BD=[],ABD=[];for(var e=0;e<PivotCollection.items.length;e++){if("string"==ruleFilters[0].type){var t=PivotCollection.items[e].getFacetByName(ruleFilters[0].name);void 0!=t&&$.inArray(t.values[0].value,ruleFilters[0].value)>-1&&A.push(PivotCollection.items[e])}else if(ruleFilters[0].type="nonstring"){var t=PivotCollection.items[e].getFacetByName(ruleFilters[0].name);void 0!=t&&ruleFilters[0].value[0]<=t.values[0].value&&ruleFilters[0].value[1]>=t.values[0].value&&A.push(PivotCollection.items[e])}if(1!=ruleNums){if("string"==ruleFilters[1].type){var t=PivotCollection.items[e].getFacetByName(ruleFilters[1].name);void 0!=t&&$.inArray(t.values[0].value,ruleFilters[1].value)>-1&&B.push(PivotCollection.items[e])}else if(ruleFilters[1].type="nonstring"){var t=PivotCollection.items[e].getFacetByName(ruleFilters[1].name);void 0!=t&&ruleFilters[1].value[0]<=t.values[0].value&&ruleFilters[1].value[1]>=t.values[0].value&&B.push(PivotCollection.items[e])}if(2!=ruleNums)if("string"==ruleFilters[2].type){var t=PivotCollection.items[e].getFacetByName(ruleFilters[2].name);void 0!=t&&$.inArray(t.values[0].value,ruleFilters[2].value)>-1&&D.push(PivotCollection.items[e])}else if(ruleFilters[2].type="nonstring"){var t=PivotCollection.items[e].getFacetByName(ruleFilters[2].name);void 0!=t&&ruleFilters[2].value[0]<=t.values[0].value&&ruleFilters[2].value[1]>=t.values[0].value&&D.push(PivotCollection.items[e])}}}if(1==ruleNums)return void getAllTable();for(var e=0;e<A.length;e++){var t=A[e].getFacetByName(ruleFilters[1].name);void 0!=t&&("string"==ruleFilters[1].type?$.inArray(t.values[0].value,ruleFilters[1].value)>-1&&AB.push(A[e]):(ruleFilters[1].type="nonstring")&&ruleFilters[1].value[0]<=t.values[0].value&&ruleFilters[1].value[1]>=t.values[0].value&&AB.push(A[e]))}if(2==ruleNums)return void getAllTable();for(var e=0;e<A.length;e++){var t=A[e].getFacetByName(ruleFilters[2].name);void 0!=t&&("string"==ruleFilters[2].type?$.inArray(t.values[0].value,ruleFilters[2].value)>-1&&AD.push(A[e]):(ruleFilters[2].type="nonstring")&&ruleFilters[2].value[0]<=t.values[0].value&&ruleFilters[2].value[1]>=t.values[0].value&&AD.push(A[e]))}for(var e=0;e<B.length;e++){var t=B[e].getFacetByName(ruleFilters[2].name);void 0!=t&&("string"==ruleFilters[2].type?$.inArray(t.values[0].value,ruleFilters[2].value)>-1&&BD.push(B[e]):(ruleFilters[2].type="nonstring")&&ruleFilters[2].value[0]<=t.values[0].value&&ruleFilters[2].value[1]>=t.values[0].value&&BD.push(B[e]))}for(var e=0;e<BD.length;e++){var t=BD[e].getFacetByName(ruleFilters[0].name);void 0!=t&&("string"==ruleFilters[0].type?$.inArray(t.values[0].value,ruleFilters[0].value)>-1&&ABD.push(BD[e]):(ruleFilters[0].type="nonstring")&&ruleFilters[0].value[0]<=t.values[0].value&&ruleFilters[0].value[1]>=t.values[0].value&&ABD.push(BD[e]))}getAllTable()}},PV._sortStringValues=function(e){if(PivotCollection.getCategoryByName(e).type!=PivotViewer.Models.FacetType.DateTime){var t=$("#pv-cat-"+PivotViewer.Utils.escapeMetaChars(PV.cleanName(e))+" .pv-filterpanel-accordion-facet-list"),a=t.prev().text().replace("Sort: ","");if("A-Z"==a)_listObj[PV.cleanName(e)].sort("pv-facet-value-label",{order:"asc",sortFunction:function(e,t,a){var i=e._values[a.valueName],l=t._values[a.valueName];return"asc"==a.order?i.localeCompare(l):l.localeCompare(i)}});else if("Quantity"==a)_listObj[PV.cleanName(e)].sort("pv-facet-value-count",{order:"desc"});else{var i=PivotCollection.getCategoryByName(e);if(void 0!=i.customSort){for(var l=[],n=i.customSort.sortValues.length-1;n>=0;n--)for(var o=0;o<items.length;o++)facet.customSort.sortValues[n]==$(items[o]).children(".pv-facet-value-label").text()&&l.push(items[o]);items=l}}}},PV.filterCollection=function(e){PV.deselectInfoPanel(),_selectedItem=null;var t,a,i,l,n=[],o=null;if(void 0==e){if(null!=_longstringFilters){var r=0;o=[];for(var s=0,v=_tiles.length;s<v;s++){var c=_tiles[s].item.getFacetByName(_longstringFilters.facet);void 0!=c&&c.values[0].value.toLowerCase().indexOf(_longstringFilters.value)>=0?(o[s]=!0,r++):o[s]=!1}if(0==r)return void $("#pv-long-search").css("text-decoration","line-through").css("color","red")}var p=$(".pv-facet-value:checked");n=[],t=[],a=[],i=[],l=[];for(var s=0;s<p.length;s++){var u=_nameMapping[$(p[s]).attr("itemfacet")],d=_nameMapping[$(p[s]).attr("itemvalue")],m=PivotCollection.getCategoryByName(u);if(m.doFilter)if(m.isString()||m.isLocation()){var g=t[u];void 0!=g?g.value[d+"a"]=!0:(g={facet:u,value:[],index:s},g.value[d+"a"]=!0,g.value=_stringFilters[u].value,t.push(g),t[u]=g,l[u]=!0)}else if(m.isDateTime()){var f,h=$("#pv-custom-range-"+PV.cleanName(u)+"__StartDate")[0].value,b=$("#pv-custom-range-"+PV.cleanName(u)+"__FinishDate")[0].value;h&&b?f={value:d,startDate:new Date(h),endDate:new Date(b)}:(h=$(p[s]).attr("startdate"),b=$(p[s]).attr("enddate"),f={value:d,startDate:new Date(h),endDate:new Date(b)});var _=a[u];void 0!=_?_.value.push(f):(_={facet:u,value:[f],index:s},a.push(_),a[u]=_,l[u]=!0)}}for(var s=0,v=PivotCollection.categories.length;s<v;s++){var m=PivotCollection.categories[s];if(m.doFilter){var u=m.name;if(PivotCollection.categories[s].type==PivotViewer.Models.FacetType.Number||PivotCollection.categories[s].type==PivotViewer.Models.FacetType.Ordinal){var P=$("#pv-filterpanel-category-numberitem-"+PV.cleanName(u)).find(".pv-facet-numericslider");if(P.length>0){var V=P.modSlider("getValues"),w=P.modSlider("getOptions"),C=w.max;min=w.min,V[0]==min&&V[V.length-1]==C||(i.push({facet:u,selectedMin:V[0],selectedMax:V[V.length-1],rangeMin:min,rangeMax:C}),i[u]=i[s],l[u]=!0)}}}}}else{n=[],t=_stringFilters,a=_datetimeFilters,i=_numericFilters,l=_selectedFilters;var m=e.category;if(!m.doFilter)return;if(m.isNumber()||m.isOrdinal())numericFilter=i[m.name],void 0==numericFilter?(numericFilter={facet:m.name,selectedMin:e.min,selectedMax:e.max,rangeMin:e.rangeMin,rangeMax:e.rangeMax},i.push(numericFilter),i[m.name]=numericFilter):(numericFilter.selectedMin=e.min,numericFilter.selectedMax=e.max),l[m.name]=!0;else if(!e.enlarge&&void 0!=l[m.name]||e.clear)if(m.isString()||m.isLocation()){var g=t[m.name];delete g.value[e.value+"a"],g.value.splice(g.value.indexOf(e.value),1),0==Object.keys(g.value).length&&(delete t[m.name],t.splice(g.index,1),delete l[m.name])}else{_=a[m.name];for(var y=0;y<_.value.length;y++)if(_.value[y].value==e.value){_.value.splice(y,1),0==_.value.length&&(delete a[m.name],a.splice(_.index,1),delete l[m.name]);break}}else{if(m.isString()||m.isLocation()){var g=t[m.name];void 0!=g?(g.value[e.value+"a"]=!0,g.value.push(e.value)):(g={facet:m.name,value:[e.value],index:t.length},g.value[e.value+"a"]=!0,t.push(g),t[m.name]=g)}else{var f={value:e.value,startDate:e.min,endDate:e.max},_=a[m.name];void 0!=_?_.value.push(f):(_={facet:m.name,value:[f],index:a.length},a.push(_),a[m.name]=_)}l[m.name]=!0}}for(var s=0,v=_tiles.length;s<v;s++){var k=_tiles[s];if(null!=o){if(!o[s]){k.filtered=!1;continue}}else if(null!=_longstringFilters){var c=_tiles[s].item.getFacetByName(_longstringFilters.facet);if(void 0==c||c.values[0].value.toLowerCase().indexOf(_longstringFilters.value)<0){k.filtered=!1;continue}}for(var S=0,N=t.length;S<N;S++){var c=k.item.getFacetByName(t[S].facet);if(void 0==c){if(t[S].value["(no info)a"])continue;break}for(var x,F,x=0,F=c.values.length;x<F&&!t[S].value[c.values[x].value+"a"];x++);if(x==F)break}if(S<N)k.filtered=!1;else{for(var S=0,N=i.length;S<N;S++){var c=k.item.getFacetByName(i[S].facet);if(void 0==c){if("(no info)"==i[S].selectedMin)continue;break}for(var x,F,x=0,F=c.values.length;x<F;x++){var D=parseFloat(c.values[x].value);if(!isNaN(D)&&D>=i[S].selectedMin&&D<=i[S].selectedMax)break}if(x==F)break}if(S<N)k.filtered=!1;else{for(var S=0,N=a.length;S<N;S++){var c=k.item.getFacetByName(a[S].facet);if(void 0!=c){for(var x,F,x=0,F=c.values.length;x<F;x++){for(var L=new Date(c.values[x].value),M=0,R=a[S].value.length;M<R;M++){var d=a[S].value[M];if(L>=d.startDate&&L<=d.endDate)break}if(M<R)break}if(x==F)break}else{for(var M,R,M=0,R=a[S].value.length;M<R&&"(no info)"!=a[S].value[M].value;M++);if(M==R)break}}S<N?k.filtered=!1:(k.filtered=!0,n.push(k))}}}_filterList=n,_numericFilters=i,_stringFilters=t,_datetimeFilters=a,_selectedFilters=l,null!=_longstringFilters||0!=_numericFilters.length||0!=_stringFilters.length||0!=_datetimeFilters.length?$(".pv-filterpanel-clearall").css("visibility","visible"):$(".pv-filterpanel-clearall").css("visibility","hidden");var I=PivotCollection.getCategoryByName(_nameMapping[$(".pv-facet").eq($(".pv-filterpanel-accordion").accordion("option","active")).attr("facet")]);if(e&&e.category==I){for(var s=0;s<I.index;s++)PivotCollection.categories[s].recount=!0;for(var s=I.index+1;s<PivotCollection.categories.length;s++)PivotCollection.categories[s].recount=!0}else{for(var s=0;s<PivotCollection.categories.length;s++)PivotCollection.categories[s].recount=!0;PV._filterCategory($(".pv-facet").eq($(".pv-filterpanel-accordion").accordion("option","active")))}$("#pv-toolbarpanel-countbox").html(_filterList.length);var T=$(".pv-toolbarpanel-breadcrumb");if(T.empty(),t.length>0||i.length>0||a.length>0){for(var O="|",s=0;s<t.length;s++)O+="<span class='pv-toolbarpanel-breadcrumb-facet'>"+t[s].facet+":</span><span class='pv-toolbarpanel-breadcrumb-values'>",O+=t[s].value.join(", "),O+="</span><span class='pv-toolbarpanel-breadcrumb-separator'>&gt;</span>";for(var s=0;s<i.length;s++)O+="<span class='pv-toolbarpanel-breadcrumb-facet'>"+i[s].facet+":</span><span class='pv-toolbarpanel-breadcrumb-values'>",i[s].selectedMin==i[s].rangeMin?O+="Under "+i[s].selectedMax:i[s].selectedMax==i[s].rangeMax?O+="Over "+i[s].selectedMin:i[s].selectedMin==i[s].selectedMax?O+=i[s].selectedMin:O+=i[s].selectedMin+" - "+i[s].selectedMax,O+="</span><span class='pv-toolbarpanel-breadcrumb-separator'>&gt;</span>";for(var s=0;s<a.length;s++)for(var q=0;q<a[s].value.length;q++){if(O+="<span class='pv-toolbarpanel-breadcrumb-facet'>"+a[s].facet+":</span><span class='pv-toolbarpanel-breadcrumb-values'>",void 0!=a[s].value[q].startDate&&void 0!=a[s].value[q].endDate){var z=new Date(a[s].value[q].startDate),j=new Date(a[s].value[q].endDate),U=PivotViewer.Utils.getTimeLabelFn(z,j);O+=U({value:z})+" - "+U({value:j})}else O+=a[s].value[q].value;O+="</span><span class='pv-toolbarpanel-breadcrumb-separator'>&gt;</span>"}T.append(O),TileController.setCircularEasingBoth()}A=[],B=[],AB=[],Cs=[],ACs=[],BCs=[],ABCs=[],PivotViewer.Models.string_filters=_stringFilters,PV.filterViews(),1==_options.authoring&&(PARA.string_filters=_stringFilters,PARA.num_filters=_numericFilters)},PV.initUICategory=function(e){Loader.loadColumn(e),LoadSem.acquire(function(t){var a=$("#pv-cat-"+PV.cleanName(e.name));if(e.isDateTime())PV._createDatetimeBuckets(e),a.append(PV._bucketizeDateTimeFacet(e.name,e.datetimeBuckets[0],e.datetimeBuckets[1])),a.append(PV._createDatetimeNoInfoFacet(e.name)),a.append(PV._createCustomRange(e.name)),$("#pv-cat-"+PV.cleanName(e.name)+" .pv-facet-customrange").on("change",function(e){PV._changeCustomRange(this)}),$("#pv-cat-"+PV.cleanName(e.name)+" .pv-facet-value").on("click.pv",function(e){PV.clickValue(this)}),$("#pv-cat-"+PV.cleanName(e.name)+" .pv-facet-value-label").on("click.pv",function(e){var t=$(this).prev();t.prop("checked",!t.prop("checked")),PV.clickValue(t[0])});else if(e.isString()||e.isLocation()){for(var i=0;i<PivotCollection.items.length;i++){var l=PivotCollection.items[i],n=l.getFacetByName(e.name);if(void 0!=n)for(var o=0;o<n.values.length;o++){var r=n.values[o].value,s="pv-facet-value-"+PV.cleanName(n.name)+"__"+PV.cleanName(n.values[o].value),v=_itemTotals[n.name];void 0==v&&(v=_itemTotals[n.name]={values:[],facet:n.name,filtered:!0});var c=v.values[r];void 0==c?v.values[r]={id:s,value:r,count:1}:c.count++}else{var s="pv-facet-value-"+PV.cleanName(e.name)+"__"+PV.cleanName("(no info)"),v=_itemTotals[e.name];void 0==v&&(v=_itemTotals[e.name]={values:[],facet:e.name,filtered:!0});var c=v.values["(no info)"];void 0==c?v.values["(no info)"]={id:s,value:"(no info)",count:1}:c.count++}}a.append("<input class='pv-value-search' id='pv-value-search-"+PV.cleanName(e.name)+"' type='text' placeholder='Search values...' size=15><div class='pv-search-clear' id='pv-value-search-clear-"+PV.cleanName(e.name)+"'>&nbsp;</div><br>"),void 0!=e.customSort||null!=e.customSort?a.append("<span class='pv-filterpanel-accordion-facet-sort' customSort='"+e.customSort.name+"'>Sort: "+e.customSort.name+"</span>"):a.append("<span class='pv-filterpanel-accordion-facet-sort'>Sort: A-Z</span>"),a.append(PV._createStringFilters(e.name));var l=_itemTotals[e.name];for(r in l.values)c=l.values[r],c.valueItem=$("#"+c.id),c.itemCount=c.valueItem.find("span").last();$("#pv-value-search-"+PV.cleanName(e.name)).on("keyup",function(t){var a=PV.cleanName(e.name),i=PV.cleanName(this.value.toLowerCase()),l=0,n=_listObj[PV.cleanName(e.name)];""!=i?($("#pv-value-search-clear-"+a).css("visibility","visible"),n.filter(function(e){return!!($(e.elm).children().eq(0).attr("itemvalue").toLowerCase().indexOf(i)>=0&&$(e.elm).children().eq(2).html()>0)&&(l++,!0)})):($("#pv-value-search-clear-"+a).css("visibility","hidden"),n.filter(function(e){return l++,!0})),l<=10?$(".pagination").hide():$(".pagination").show()}),$("#pv-value-search-clear-"+PV.cleanName(e.name)).click(function(t){var a=PV.cleanName(e.name);$("#pv-value-search-"+a).val(""),$("#pv-value-search-clear-"+a).css("visibility","hidden"),$('.pv-filterpanel-accordion-facet-list-item[id^="pv-facet-value-'+a+'"]').show()}),$("#pv-cat-"+PV.cleanName(e.name)+" .pv-facet-value").click(function(e){PV.clickValue(this)}),$("#pv-cat-"+PV.cleanName(e.name)+" .pv-facet-value-label").click(function(e){var t=$(this).prev();t.prop("checked",!t.prop("checked")),PV.clickValue(t[0])}),$("#pv-cat-"+PV.cleanName(e.name)+" .pv-filterpanel-accordion-facet-sort").click(function(e){var t=$(this),a=t.text(),i=t.parent().prev().children("a")[0].title,l=t.attr("customSort");"Sort: A-Z"==a?$(this).text("Sort: Quantity"):"Sort: Quantity"==a&&void 0==l?$(this).text("Sort: A-Z"):"Sort: Quantity"==a?$(this).text("Sort: "+l):$(this).text("Sort: A-Z"),PV._sortStringValues(i)})}else if(e.isNumber()){for(var i=0;i<PivotCollection.items.length;i++){var l=PivotCollection.items[i],n=l.getFacetByName(e.name);if(void 0!=n)for(var o=0;o<n.values.length;o++){var r=n.values[o].value,c=_numericItemTotals[n.name];void 0!=c?c.values.push(r):_numericItemTotals[n.name]={facet:n.name,values:[r],filtered:!0}}else{var s="pv-facet-value-"+PV.cleanName(e.name)+"__"+PV.cleanName("(no info)"),v=_itemTotals[e.name];void 0==v&&(v=_itemTotals[e.name]={values:[],facet:e.name,filtered:!0});var c=v.values["(no info)"];void 0==c?v.values["(no info)"]={id:s,value:"(no info)",count:1}:c.count++}}a.append("<div id='pv-filterpanel-category-numberitem-"+PV.cleanName(e.name)+"'></div>")}else if(e.isOrdinal()){for(var i=0;i<PivotCollection.items.length;i++){var l=PivotCollection.items[i],n=l.getFacetByName(e.name);if(void 0!=n)for(var o=0;o<n.values.length;o++){var r=n.values[o].value,c=_ordinalItemTotals[n.name];void 0!=c?c.values.push(r):_ordinalItemTotals[n.name]={facet:n.name,values:[r],filtered:!0}}else{
var s="pv-facet-value-"+PV.cleanName(e.name)+"__"+PV.cleanName("(no info)"),v=_itemTotals[e.name];void 0==v&&(v=_itemTotals[e.name]={values:[],facet:e.name,filtered:!0});var c=v.values["(no info)"];void 0==c?v.values["(no info)"]={id:s,value:"(no info)",count:1}:c.count++}}a.append("<div id='pv-filterpanel-category-numberitem-"+PV.cleanName(e.name)+"'></div>")}e.uiInit=!0,t()})},PV._filterCategory=function(e){var t=PivotCollection.getCategoryByName(_nameMapping[e.attr("facet")]);t.isFilterVisible&&(t.uiInit||PV.initUICategory(t),LoadSem.acquire(function(e){var a=[];if(2*_filterList.length<_tiles.length)a=_filterList;else for(var i=0;i<_tiles.length;i++)_tiles[i].filtered||a.push(_tiles[i]);if(t.isString()||t.isLocation()){for(var l=[],n=PivotViewer.Utils.escapeMetaChars("pv-facet-value-"+PV.cleanName(t.name)+"__"+PV.cleanName("(no info)")),o=0;o<a.length;o++){var r=a[o].item.getFacetByName(t.name);if(void 0!=r)for(var s=0;s<r.values.length;s++){var v=PivotViewer.Utils.escapeMetaChars("pv-facet-value-"+PV.cleanName(t.name)+"__"+PV.cleanName(r.values[s].value)),c=l[v];void 0!=c?c.count++:l[v]={count:1}}else{var c=l[n];void 0!=c?c.count++:l[n]={count:1}}}if(a==_filterList){var p=_itemTotals[t.name].values;for(var u in p){var v=p[u];void 0==l[v.id]?_selectedFilters[t.name]||v.valueItem.hide():(v.valueItem.show(),v.itemCount.text(l[v.id].count))}}else{var p=_itemTotals[t.name].values;for(var u in p){var d,v=p[u];d=void 0==l[v.id]?_itemTotals[t.name].values[u].count:_itemTotals[t.name].values[u].count-l[v.id].count,0==d?_selectedFilters[t.name]||v.valueItem.hide():(v.valueItem.show(),v.itemCount.text(d))}}var m={pagination:[{outerWindow:1,innerWindow:1}],page:10,valueNames:["pv-facet-value-label","pv-facet-value-count"]};if(_listObj[PV.cleanName(t.name)]||(_listObj[PV.cleanName(t.name)]=new List("pv-cat-"+PV.cleanName(t.name),m)),t.recount)for(var i=0;i<_listObj[PV.cleanName(t.name)].items.length;i++){var v=_listObj[PV.cleanName(t.name)].items[i],u=v._values["pv-facet-value-label"];v._values["pv-facet-value-count"]=$(v.elm.lastChild).text()}var g=0;_listObj[PV.cleanName(t.name)].filter(function(e){return"none"!=$(e.elm).css("display")&&(g++,!0)}),g<=10?$(".pagination").hide():$(".pagination").show()}else if(t.isDateTime()){for(var l=[],n=PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(t.name)+"__"+PV.cleanName("(no info)")),i=0;i<a.length;i++){var r=a[i].item.getFacetByName(t.name);if(void 0==r){var c=l[n];void 0!=c?c.count++:l[v]={count:1}}else for(var o=0;o<t.datetimeBuckets.length&&o<2;o++)for(var f=t.datetimeBuckets[o],s=0;s<f.length;s++)if(void 0!=f[s].items[a[i].item.id+"a"]){var v=PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(t.name)+"__"+PV.cleanName(f[s].name.toString())),c=l[v];void 0!=c?c.count++:l[v]={count:1};break}}if(a==_filterList)for(var o=0;o<t.datetimeBuckets.length&&o<2;o++)for(var f=t.datetimeBuckets[o],s=0;s<f.length;s++)v=PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(t.name)+"__"+PV.cleanName(f[s].name.toString())),void 0==l[v]?_selectedFilters[t.name]||$(v).hide():($(v).show(),$(v).find("span").last().text(l[v].count));else for(var o=0;o<t.datetimeBuckets.length&&o<2;o++)for(var f=t.datetimeBuckets[o],s=0;s<f.length;s++){v=PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(t.name)+"__"+PV.cleanName(f[s].name.toString()));var d;d=void 0==l[v]?f[s].items.length:f[s].items.length-l[v].count,0==d?_selectedFilters[t.name]||$(v).hide():($(v).show(),$(v).find("span").last().text(d))}}else if(t.isNumber()){if(!_selectedFilters[t.name])if(_filterList.length==_tiles.length)PV._refreshNumberWidget(t,_numericItemTotals[t.name].values);else{for(var p=[],i=0;i<_filterList.length;i++){var r=_filterList[i].item.getFacetByName(t.name);if(void 0!=r)for(var h=0;h<r.values.length;h++)p.push(r.values[h].value)}PV._refreshNumberWidget(t,p)}}else if(t.isOrdinal()&&!_selectedFilters[t.name])if(_filterList.length==_tiles.length)PV._refreshOrdinalWidget(t,_ordinalItemTotals[t.name].values);else{for(var p=[],i=0;i<_filterList.length;i++){var r=_filterList[i].item.getFacetByName(t.name);if(void 0!=r)for(var h=0;h<r.values.length;h++)p.push(r.values[h].value)}PV._refreshOrdinalWidget(t,p)}Settings.showMissing?$("#pv-facet-value-"+PV.cleanName(t.name)+"__"+PV.cleanName("(no info)")).show():$("#pv-facet-value-"+PV.cleanName(t.name)+"__"+PV.cleanName("(no info)")).hide(),t.recount=!1,e()}))},PV.deselectInfoPanel=function(){$(".pv-infopanel").fadeOut(),$(".pv-infopanel-heading").empty(),$(".pv-infopanel-details").empty()},PV.cleanName=function(e){var t=e.replace(/[^\w]/gi,"_");return _nameMapping[t]=e,t},PV.uncleanName=function(e){return _nameMapping[e]},$.subscribe("/PivotViewer/Models/Collection/Loaded",function(e){Lawnchair({name:PivotCollection.name},function(e,t){}).get("Settings",function(e){if(null!=e){Settings=e.value;for(var t=0;t<Settings.visibleCategories.length;t++)Settings.visibleCategories[PivotCollection.categories[Settings.visibleCategories[t]].name]=!0}else{Settings.showMissing=!1,Settings.visibleCategories=[];for(var t=0;t<PivotCollection.categories.length;t++)Settings.visibleCategories.push(t),Settings.visibleCategories[PivotCollection.categories[t].name]=!0}$.publish("/PivotView/Models/Settings/Loaded")})}),$.subscribe("/PivotView/Models/Settings/Loaded",function(e){var t="<div class='pv-toolbarpanel'>",a=PivotCollection.brandImage;a.length>0&&(t+="<img class='pv-toolbarpanel-brandimage' src='"+a+"'></img>"),t+="<span class='pv-countbox' id='pv-toolbarpanel-countbox' width=25></span>",t+="<div class='pv-toolbarpanel-breadcrumb'></div>",t+="<div class='pv-toolbarpanel-viewcontrols'></div>",t+="<div id='pv-primsortcontrols' class='pv-toolbarpanel-sortcontrols'></div>",t+="<div class='pv-toolbarpanel-zoomcontrols'><div class='pv-toolbarpanel-zoomslider'></div></div>",t+="<div class='pv-toolbarpanel-info'></div>",t+="</div>",_self.append(t),$("#pv-altsort").hide(),$(".pv-toolbarpanel-zoomslider").slider({max:100,stop:function(e,t){PV.zoom(t.value)}}),_self.append("<div class='pv-mainpanel'></div>");var i=$(window).height()-$(".pv-toolbarpanel").height()-30;$(".pv-mainpanel").css("height",i+"px"),$(".pv-mainpanel").append("<div class='pv-filterpanel'></div>"),$(".pv-mainpanel").append("<div class='pv-viewpanel'><canvas class='pv-canvas' width='"+_self.width()+"' height='"+i+"px'></canvas></div>"),$(".pv-mainpanel").append("<div class='pv-infopanel'></div>");var l=$(".pv-filterpanel"),n="<div class='pv-filterpanel-clearall'><span class='pv-filterpanel-clearall-label'>Clear All&nbsp;</span><i class='material-icons' rel='tooltip' title='Clear All'></i></div>";n+="<div class='pv-filterpanel-search-box'><br><br><input class='pv-filterpanel-search' type='text' placeholder='Search variables...' /></div>",l.append(n).css("height",i-13+"px"),$(".pv-filterpanel-search").css("width",l.width()-15+"px");var o=$(".pv-infopanel");o.css("left",$(".pv-mainpanel").offset().left+$(".pv-mainpanel").width()-205+"px").css("height",i-28+"px"),o.append("<div class='pv-infopanel-controls'></div>"),$(".pv-infopanel-controls").append("<div><div class='pv-infopanel-controls-navleft'></div><div class='pv-infopanel-controls-navleftdisabled'></div><div class='pv-infopanel-controls-navbar'></div><div class='pv-infopanel-controls-navright'></div><div class='pv-infopanel-controls-navrightdisabled'></div></div>"),$(".pv-infopanel-controls-navleftdisabled").hide(),$(".pv-infopanel-controls-navrightdisabled").hide(),o.append("<div class='pv-infopanel-heading'></div>"),o.append("<div class='pv-infopanel-details'></div>"),PivotCollection.maxRelatedLinks>0&&o.append("<div class='pv-infopanel-related'></div>"),""!=PivotCollection.copyrightName&&o.append("<div class='pv-infopanel-copyright'><a href=\""+PivotCollection.copyrightHref+'" target="_blank">'+PivotCollection.copyrightName+"</a></div>"),o.hide();var r=PivotCollection.imageBase;r.indexOf("http",0)>=0||r.indexOf("www.",0)>=0||(r=PivotCollection.base.substring(0,PivotCollection.base.lastIndexOf("/")+1)+r);var s=$(".pv-canvas")[0].getContext("2d");TileController=new PivotViewer.Views.TileController(_imageController),_tiles=TileController.initTiles(PivotCollection.items,r,s),_imageController.setup(r.replace("\\","/"))}),$.subscribe("/PivotViewer/Settings/Changed",function(e){var t=PivotCollection.categories[e.visibleCategories[0]];t.uiInit||PV.initUICategory(t),PV.selectView(0),LoadSem.acquire(function(a){var i=$(".pv-facet"),l=$(".pv-toolbarpanel-sort"),n=$("#pv-long-search-cat");i.hide(),i.attr("visible","invisible"),$(".pv-toolbarpanel-sort option").remove(),$("#pv-long-search-cat option").remove(),_longStringCategories=[];for(var o=0;o<e.visibleCategories.length;o++){var r=PivotCollection.categories[e.visibleCategories[o]];r.isFilterVisible&&(r.isLongString()?(n.append("<option value='"+PV.cleanName(r.name)+"'>"+r.name+"</option>"),_longStringCategories.push(r)):(r.recount=!0,i.eq(r.visIndex).show(),i.eq(r.visIndex).attr("visible","visible"),l.append("<option value='"+o+"' search='"+PV.cleanName(r.name.toLowerCase())+"'>"+r.name+"</option>")))}0==$("#pv-long-search-cat option").length?(n.hide(),$("#pv-long-search").hide()):(n.show(),$("#pv-long-search").show()),PV._filterCategory(i.eq(t.visIndex)),$(".pv-filterpanel-accordion").accordion("option","active",t.visIndex),$("#pv-primsort").trigger("change"),a()})}),$.subscribe("/PivotViewer/ImageController/Collection/Loaded",function(event){for(var facets=["<div class='pv-filterpanel-accordion'>"],longSearch=["<div id='pv-long-search-box'><br><select id='pv-long-search-cat'>"],sort=[],activeNumber=0,i=0;i<PivotCollection.categories.length;i++){var category=PivotCollection.categories[i];category.isFilterVisible&&(category.isLongString()?(longSearch.push("<option value='"+PV.cleanName(category.name.toLowerCase())+"'>"+category.name+"</option>"),_longStringCategories.push(category)):(activeNumber++,facets.push("<h3 class='pv-facet' style='display:inherit' facet='"+PV.cleanName(category.name.toLowerCase())+"'><a href='#' title='"+category.name+"'>"+category.name+"</a><div class='pv-filterpanel-accordion-heading-clear' facetType='"+category.type+"'>&nbsp;</div></h3><div style='display:'inherit' style='height:30%' id='pv-cat-"+PV.cleanName(category.name)+"'></div>"),sort.push("<option value='"+i+"' search='"+PV.cleanName(category.name.toLowerCase())+"'>"+category.name+"</option>")))}longSearch.length>1&&(longSearch.push("</div></select>"),$(".pv-filterpanel").append(longSearch.join("")+"<span class='pv-search-clear' id='pv-long-search-clear'>&nbsp;</span><input type=text length=25 id='pv-long-search' placeholder='Search text...'>"),$("#pv-long-search").on("keyup",function(e){this.value.toLowerCase();if(13==e.keyCode){var t=PivotCollection.getCategoryByName([$("#pv-long-search-cat option:selected").text()]);t.uiInit||(Loader.loadColumn(t),t.uiInit=!0),LoadSem.acquire(function(e){_longstringFilters=null!=$("#pv-long-search").val()&&""!=$("#pv-long-search").val()?{facet:$("#pv-long-search-cat option:selected").text(),value:$("#pv-long-search").val().toLowerCase()}:null,PV.filterCollection(),e()})}else $("#pv-long-search").css("text-decoration","").css("color","black");$("#pv-long-search-clear").css("visibility","visible")}),$("#pv-long-search-clear").click(function(e){$("#pv-long-search").val(""),$("#pv-long-search-clear").css("visibility","hidden"),null!=_longstringFilters&&(_longstringFilters=null,PV.filterCollection())}),$("#pv-long-search-cat").on("mousedown",function(e){if(1==$(this).attr("dirty")){$("#pv-long-search-cat option").remove();for(var t=$(".pv-filterpanel-search").val(),a=0;a<_longStringCategories.length;a++){var i=_longStringCategories[a],l=PV.cleanName(i.name);""!=t&&l.indexOf(t)<0||$("#pv-long-search-cat").append("<option value='"+PV.cleanName(i.name)+"'>"+i.name+"</option>")}}$(this).attr("dirty",0)})),facets.push("</div>"),$(".pv-filterpanel").append(facets.join("")),$(".pv-filterpanel-accordion").css("height",$(".pv-filterpanel").height()-$(".pv-filterpanel-search").height()-75-$("#pv-long-search-box").height()+"px"),$(".pv-filterpanel-accordion").accordion({icons:!1}),$("#pv-primsortcontrols").append('<select id="pv-primsort" class="pv-toolbarpanel-sort">'+sort.join("")+"</select>"),$(".pv-filterpanel-accordion").accordion("option","active",activeNumber);var viewPanel=$(".pv-viewpanel"),width=_self.width(),height=$(".pv-mainpanel").height(),offsetX=$(".pv-filterpanel").width()+18,offsetY=4;void 0==PivotCollection.config&&(PivotCollection.config=[]),void 0==PivotCollection.config.views&&(void 0==_enabledView?PivotCollection.config.views=["grid","bucket","crosstab"]:PivotCollection.config.views=_enabledView),void 0!=_options.View&&PivotCollection.config.views.indexOf(_options.View)<0&&PivotCollection.config.views.push(_options.View);for(var i=0;i<PivotCollection.config.views.length;i++)if("r"!=PivotCollection.config.views[i]){var viewName=PivotCollection.config.views[i];PivotViewer.Utils.loadScript("src/views/"+viewName.toLowerCase()+"view.min.js"),eval("var view = new PivotViewer.Views."+viewName.charAt(0).toUpperCase()+viewName.substring(1)+"View()"),view.setOptions(_options),_views.push(view)}else _rEnable=!0;viewPanel.append("<div class='pv-viewpanel-view'></div>");for(var i=0;i<_views.length;i++)_views[i]instanceof PivotViewer.Views.IPivotViewerView&&(_views[i].setup(width,height,offsetX,offsetY,TileController.getMaxTileRatio()),$(".pv-toolbarpanel-viewcontrols").append("<div class='pv-toolbarpanel-view' id='pv-toolbarpanel-view-"+i+"' title='"+_views[i].getViewName()+"'><img id='pv-viewpanel-view-"+i+"-image' src='"+_views[i].getButtonImage()+"' alt='"+_views[i].getViewName()+"' /></div>"));1==_rEnable&&($(".pv-toolbarpanel-viewcontrols").append("<div class='pv-toolbarpanel-view'id='pv-toolbarpanel-view-10' title='Statistical Model'><a href='#pv-open-Model'> <img id='pv-toolbarpanel-view-10-image' src='images/ModelView.png'></a></div>"),$(".pv-toolbarpanel-viewcontrols").append('<div class="modal fade" id="myModal" role="dialog" style="z-index:100000;"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">R result</h4></div><div class="modal-body" ><code><pre id="pv-model-result" style="position: relative;             "></pre></code></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div>'),$(".pv-toolbarpanel-viewcontrols").append("<div id='pv-open-Model' class='pv-modal-dialog modal-xl'><div><h2>Statistical Model</h2><div id='pv-model-text'>&nbsp;</div></div></div>")),$(".pv-loading").remove();var controlsWidth=$(".pv-toolbarpanel").innerWidth()-($(".pv-toolbarpanel-brandimage").outerWidth(!0)+25+$(".pv-toolbarpanel-name").outerWidth(!0)+30+$(".pv-toolbarpanel-zoomcontrols").outerWidth(!0)+29*_views.length+2*$(".pv-toolbarpanel-sortcontrols").outerWidth(!0));$(".pv-toolbarpanel-breadcrumb").css("width",controlsWidth+"px");var filterPanel=$(".pv-filterpanel");filterPanel.append("<div class='pv-filterpanel-version'><a href='#pv-open-version'>About</a>&nbsp;<a href='#pv-open-Settings'>Settings</a></div>"),filterPanel.append("<div id='pv-open-version' class='pv-modal-dialog'><div><a href='#pv-modal-dialog-close' title='Close' class='pv-modal-dialog-close'>X</a><h2>SuAVE: <u>Su</u>rvey <u>A</u>nalysis via <u>V</u>isual <u>E</u>xploration</h2><p>See examples and tutorials at <a href=\"http://suave.sdsc.edu/\" target=\"blank\">http://suave.sdsc.edu</a><p>Initially funded by <a href='http://www.nsf.gov/awardsearch/showAward?AWD_ID=1443082'>NSF Grant ACI-1443082</a>.</div></div>"),filterPanel.append("<div id='pv-open-Settings' class='pv-modal-dialog modal-xl'><div><h2>Settings</h2><div id='pv-options-text'>&nbsp;</div></div></div>");var html="<input type='checkbox' id='show-missing'"+(Settings.showMissing?" checked":"")+"> Display missing values<p><h3>Visible Variables (Double-click to select)</h3><p>";html+="<table><tr><th>All Variables:</th><th>Variables to Display:</th><tr><td><select id='pv-all-columns' multiple style='width:250px' size=20>";for(var i=0;i<PivotCollection.categories.length;i++){var category=PivotCollection.categories[i];html+="<option value="+i+" search='"+PV.cleanName(category.name.toLowerCase())+"'>"+category.name+"</option>"}if(html+="</select></td><td><select id='pv-column-select' multiple style='width:250px' size=20>",0==Settings.visibleCategories.length)html+="<option value='-1'>Select Variables...</option>";else for(var i=0;i<Settings.visibleCategories.length;i++){var category=PivotCollection.categories[Settings.visibleCategories[i]];html+="<option value="+Settings.visibleCategories[i]+" search='"+PV.cleanName(category.name.toLowerCase())+"'>"+category.name+"</option>"}html+="</select></td><td width=200><input id='pv-column-search' placeholder='Search For Variable...' type='text' size=20><div class='pv-search-clear' id='pv-column-search-clear'>&nbsp;</div><p><button id='pv-column-select-all'>Select All</button><p><button id='pv-column-deselect-all'>Deselect All</button><p><button id='pv-settings-submit'>Submit</button><p><button id='pv-Settings-cancel'>Cancel</button></td></table>",$("#pv-options-text").html(html);var modelHtml="<p><h3>Press ctrl(Windows)/command(Mac) to select independent variables</h3><p>";modelHtml+="<table><tr><th>Dependent Variable:</th><th>Independent Variables:</th><tr><td><select id='pv-all-variables1' style='width:250px' size=20>";for(var i=0;i<PivotCollection.categories.length;i++){var category=PivotCollection.categories[i];modelHtml+="<option value="+i+" search='"+PV.cleanName(category.name.toLowerCase())+"'>"+category.name+"</option>"}modelHtml+="</select></td><td><select id='pv-all-variables2' multiple style='width:250px' size=20>";for(var i=0;i<PivotCollection.categories.length;i++){var category=PivotCollection.categories[i];modelHtml+="<option value="+i+" search='"+PV.cleanName(category.name.toLowerCase())+"'>"+category.name+"</option>"}modelHtml+="</select></td><td width=200><p><select id='pv-select-model'><option>Select Model</option><option>Logit</option><option>Probit</option><option>Log Linear</option></select><p><input id='pv-variables-search' placeholder='Search For Variable...' type='text' size=20><div class='pv-search-clear' id='pv-variables-search-clear'>&nbsp;</div><p><button id='pv-model-submit'>Submit</button></p><p><button id='pv-model-cancel'>Cancel</button></td></table>",$("#pv-model-text").html(modelHtml),$("#pv-all-columns").dblclick(function(e){if(!($("#pv-all-columns option[value='-1']").length>0)){var t=parseFloat($("#pv-all-columns").val()),a=PivotCollection.categories[t];$("#pv-column-select option[value='-1']").length>0&&$("#pv-column-select option[value='-1']").remove();for(var i=$("#pv-column-select option"),l=0;l<i.length&&parseFloat(i[l].value)!=t;l++)if(parseFloat(i[l].value)>t){$(i[l]).before($("<option></option>").attr("search",PV.cleanName(a.name.toLowerCase())).val(t).html(a.name));break}l==i.length&&$("#pv-column-select").append("<option value="+t+" search='"+PV.cleanName(a.name.toLowerCase())+"'>"+a.name+"</option>")}}),$("#pv-column-select").dblclick(function(e){if(!($("#pv-column-select option[value='-1']").length>0)){var t=parseFloat($("#pv-column-select").val());PivotCollection.categories[t];$("#pv-column-select option[value='"+t+"']").remove(),0==$("#pv-column-select option").length&&$("#pv-column-select").append("<option value='-1'>Select Variables...</option>")}}),$("#pv-column-select-all").click(function(e){var t=$("#pv-all-columns option"),a=$("#pv-column-select option");if(-1!=t.eq(0).val()){-1==a.eq(0).val()&&$("#pv-column-select option").remove();for(var i=0,l=0;i<t.length;){var n=parseFloat(t.eq(i).val()),o=PivotCollection.categories[n];l==a.length?($("#pv-column-select").append($("<option></option>").attr("search",PV.cleanName(o.name.toLowerCase())).val(n).html(o.name)),i++):n==parseFloat(a[l].value)?(i++,l++):parseFloat(a[l].value)>n?($(a[l]).before($("<option></option>").attr("search",PV.cleanName(o.name.toLowerCase())).val(n).html(o.name)),i++):l++}}}),$("#pv-column-deselect-all").click(function(e){$("#pv-column-select option").remove(),$("#pv-column-select").append("<option value='-1'>Select Variables...</option>")}),$("#pv-settings-submit").click(function(e){Settings.visibleCategories=[];for(var t=$("#pv-column-select option"),a=0;a<t.length;a++)Settings.visibleCategories.push(t[a].value),Settings.visibleCategories[t[a].innerHTML]=!0;Settings.showMissing=$("#show-missing").prop("checked"),Lawnchair({name:PivotCollection.name},function(e,t){}).save({key:"Settings",value:Settings}),$.publish("/PivotViewer/Settings/Changed",[Settings]),window.open("#pv-modal-dialog-close","_self"),_sortCategory=$("#pv-primsort option").eq(0).html();var i=PivotCollection.getCategoryByName(_sortCategory);i.uiInit||PV.initUICategory(i),LoadSem.acquire(function(e){_tiles.sort(tileSortBy(_sortCategory,!1,_stringFilters)),_filterList=[];for(var t=0;t<_tiles.length;t++){var a=_tiles[t];a.missing=!Settings.showMissing&&void 0==a.item.getFacetByName(i.name),a.filtered&&_filterList.push(_tiles[t])}PV.filterViews(),e()})}),$("#pv-Settings-cancel").click(function(e){window.open("#pv-modal-dialog-close","_self"),$("#show-missing").prop("checked",Settings.showMissing),-1==$("#pv-all-columns option").eq(0).val()&&$("#pv-all-columns option").remove(),PV._initAllSelect("#pv-all-columns"),-1==$("#pv-column-select option").eq(0).val()&&$("#pv-column-select option").remove(),PV._initVisibleSelect("#pv-column-select",!0),$("#pv-column-search").val(""),$("#pv-column-search-clear").css("visibility","hidden")}),$("#pv-model-submit").click(function(e){$("#myModal").modal("toggle");var t=$("#pv-all-variables2").val(),a=$("#pv-all-variables1").val();void 0!=t&&void 0!=a||alert("Please select at least one dependent variable, and one independent variable");for(var i="V"+(parseInt(a)+1)+"~",l=t.length,n=0;n<l;n++)0!=n&&(i+="+"),i=i+"V"+(parseInt(t[n])+1);var o=$("#pv-select-model").val();"Select Model"==o?alert("Please select a statistical model"):getModel(o,i)}),$("#pv-model-cancel").click(function(e){window.open("#pv-modal-dialog-close","_self"),-1==$("#pv-all-variables1 option").eq(0).val()&&$("#pv-all-variables1 option").remove(),PV._initAllSelect("#pv-all-variables1"),-1==$("#pv-all-variables2 option").eq(0).val()&&$("#pv-all-variables2 option").remove(),PV._initAllSelect("#pv-all-variables2"),$("#pv-variables-search").val(""),$("#pv-variables-search-clear").css("visibility","hidden")}),$("#pv-column-search").on("keyup",function(e){var t=this.value.toLowerCase();""!=t?(-1==$("#pv-all-columns option").eq(0).val()&&$("#pv-all-columns option").remove(),PV._initAllSelect("#pv-all-columns",t),$("#pv-column-search-clear").css("visibility","visible"),0==$("#pv-all-columns option").length&&$("#pv-all-columns").append("<option value='-1' css:'display: block'>No matching variables.</option>")):($("#pv-column-search-clear").css("visibility","hidden"),PV._initAllSelect("#pv-all-columns"))}),$("#pv-column-search-clear").click(function(e){$("#pv-column-search").val(""),$("#pv-column-search-clear").css("visibility","hidden"),-1==$("#pv-all-columns option").eq(0).val()&&$("#pv-all-columns option").remove(),PV._initAllSelect("#pv-all-columns")}),$("#pv-variables-search").on("keyup",function(e){var t=e.target.value.toLowerCase();""!=t?(-1==$("#pv-all-variables1 option").eq(0).val()&&$("#pv-all-variables1 option").remove(),PV._initAllSelect("#pv-all-variables1",t),-1==$("#pv-all-variables2 option").eq(0).val()&&$("#pv-all-variables2 option").remove(),PV._initAllSelect("#pv-all-variables2",t),$("#pv-variables-search-clear").css("visibility","visible"),0==$("#pv-all-variables1 option").length&&$("#pv-all-variables1").append("<option value='-1' css:'display: block'>No matching variables.</option>"),0==$("#pv-all-variables2 option").length&&$("#pv-all-variables2").append("<option value='-1' css:'display: block'>No matching variables.</option>")):($("#pv-variables-search-clear").css("visibility","hidden"),PV._initAllSelect("#pv-all-variables1"),PV._initAllSelect("#pv-all-variables2"))}),$("#pv-variables-search-clear").click(function(e){$("#pv-variables-search").val(""),$("#pv-variables-search-clear").css("visibility","hidden"),-1==$("#pv-all-variables1 option").eq(0).val()&&$("#pv-all-variables1 option").remove(),PV._initAllSelect("#pv-all-variables1"),-1==$("#pv-all-variables2 option").eq(0).val()&&$("#pv-all-variables2 option").remove(),PV._initAllSelect("#pv-all-variables2")}),$(".pv-toolbarpanel-view").click(function(e){var t=this.id.substring(this.id.lastIndexOf("-")+1,this.id.length);null!=t&&10!=t&&PV.selectView(parseInt(t))}),$("#pv-primsort").on("change",function(e){_sortCategory=$("#pv-primsort option:selected").html();var t=PivotCollection.getCategoryByName(_sortCategory);t.uiInit||PV.initUICategory(t),LoadSem.acquire(function(e){_tiles.sort(tileSortBy(_sortCategory,!1,_stringFilters)),_filterList=[];for(var t=0;t<_tiles.length;t++){var a=_tiles[t];a.missing=!Settings.showMissing&&void 0==a.item.getFacetByName(_sortCategory),a.filtered&&_filterList.push(_tiles[t])}1==_options.authoring&&(PARA.x_axis=_sortCategory),PV.filterViews(),e()})}),$(".pv-facet").click(function(e){PV._filterCategory($(this))}),$(".pv-filterpanel-clearall").click(function(e){$(".pv-filterpanel-search").val(""),clearSearch();var t=$(".pv-facet-value:checked");t.prop("checked",!1);for(var a=0;a<t.length;a++)"CustomRange"==t.eq(a).attr("itemvalue")&&PV._hideCustomDateRange($(t[a]).attr("itemfacet"));for(var i in _listObj)for(var l=_listObj[i],n=0;n<l.matchingItems.length;n++)l.matchingItems[n].elm.firstChild.checked=!1;var o=$(".pv-facet-numericslider");o.modSlider("clearValues"),o.siblings(".pv-facet-numericslider-range-val").html("&nbsp;"),$(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden"),$("#pv-long-search-clear").css("visibility","hidden"),$("#pv-long-search").val(""),$(".pv-value-search").val(""),$(".pv-search-clear").css("visibility","hidden"),_longstringFilters=null,PV.filterCollection()}),$(".pv-filterpanel-accordion-heading-clear").click(function(e){$(this).parent().next().find(".pv-value-search").val(""),$(this).parent().next().find(".pv-search-clear").css("visibility","hidden");var t=this.attributes.facetType.value;if("DateTime"==t){var a=$(this).parent().next().find(".pv-facet-value:checked");a.prop("checked",!1);for(var i=0;i<a.length;i++)PV._hideCustomDateRange($(a[i]).attr("itemfacet"))}else if("String"==t){var l=$(this).parent().attr("aria-controls").substring(7),n=_listObj[l];if(void 0!=n){n.size();n.update();var o=$(this).parent().next().find(".pv-facet-value:checked");$(this).parent().next().find(".pv-facet-value:checked").prop("checked",!1);var r=_listObj[o.eq(0).attr("itemfacet")];if(void 0!=r)for(var i=0;i<r.matchingItems.length;i++)r.matchingItems[i].elm.firstChild.checked=!1;n.update()}}else if("Number"==t||"Ordinal"==t){var s=$(this).parent().next().find(".pv-facet-numericslider");s.modSlider("clearValues"),s.siblings(".pv-facet-numericslider-range-val").html("&nbsp;")}PV.filterCollection(),$(this).css("visibility","hidden")}),$(".pv-facet-customrange").on("change",function(e){PV._changeCustomRange(this)}),$(".pv-infopanel-details").on("click",".detail-item-value-filter",function(e){return $(".pv-facet[aria-controls='pv-cat-"+PV.cleanName($(this).parent().children().attr("pv-detail-item-title"))+"']").trigger("click"),PV.clickValue,$.publish("/PivotViewer/Views/Item/Filtered",[{category:$(this).parent().children().attr("pv-detail-item-title"),min:$(this).attr("pv-detail-item-value"),values:null}]),!1}),$(".pv-infopanel-details").on("click",".pv-infopanel-detail-description-more",function(e){var t=$(this),a=t.prev();"More"==t.text()?(a.css("height",""),t.text("Less")):(a.css("height","100px"),t.text("More"))}),$(".pv-infopanel-controls-navleft").click(function(e){for(var t=1;t<_filterList.length;t++)if(_filterList[t].item.id==_selectedItem.item.id){var a=_filterList[t-1];$.publish("/PivotViewer/Views/Item/Selected",[{item:a}]),_views[_currentView].centerOnTile(a);break}}),$(".pv-infopanel-controls-navright").click(function(e){for(var t=0;t<_filterList.length-1;t++)if(_filterList[t].item.id==_selectedItem.item.id){var a=_filterList[t+1];$.publish("/PivotViewer/Views/Item/Selected",[{item:a}]),_views[_currentView].centerOnTile(a);break}}),$(".pv-toolbarpanel-sort").on("mousedown",function(e){1==$(this).attr("dirty")&&PV._initVisibleSelect("#"+$(this).attr("id"),!1,PV.cleanName($(".pv-filterpanel-search").val().toLowerCase())),$(this).attr("dirty",0)}),$(".pv-value-search").on("keyup",function(e){var t=PV.cleanName(this.value.toLowerCase());if(""!=t){var a=PivotCollection.getCategoryByName(_nameMapping[$(".pv-facet").eq($(".pv-filterpanel-accordion").accordion("option","active")).attr("facet")]),i=[];(a.isString()||a.isLocation())&&-1==a.name.toLowerCase().indexOf(t)&&(i=$('.pv-filterpanel-accordion-facet-list-item[id^="pv-facet-value-'+PV.cleanName(a.name)+'"]'),i.hide(),i=i.filter(function(){return PV.cleanName($(this).children().eq(0).attr("itemvalue").toLowerCase()).indexOf(t)>=0&&$(this).children().eq(2).html()>0}),i.show())}else $(".pv-filterpanel-accordion-facet-list-item").show()}),$("#pv-value-search-clear").click(function(e){$(".pv-value-search").val(""),$("#pv-value-search-clear").css("visibility","hidden"),$(".pv-filterpanel-accordion").accordion("option","collapsible",!1),$(".pv-filterpanel-accordion-facet-list-item").show()}),$(".pv-filterpanel-search").on("keyup",function(e){var t=PV.cleanName(this.value.toLowerCase());if(""!=t){var a=$(".pv-facet[facet*='"+t+"'][visible='visible']");if(a.show(),$(".pv-toolbarpanel-sort").attr("dirty",1),$("#pv-long-search-cat").attr("dirty",1),$("#pv-long-search-cat").val($("#pv-long-search-cat option[value*='"+t+"']").eq(0).val()),$(".pv-facet:not([facet*='"+t+"'][visible='visible'])").hide(),$("#pv-filterpanel-search-clear").css("visibility","visible"),a.length>0){var i=PivotCollection.getCategoryByName(_nameMapping[a.eq(0).attr("facet")]);i.uiInit||PV.initUICategory(i),LoadSem.acquire(function(e){$(".pv-filterpanel-accordion").accordion("option","collapsible",!1),$(".pv-filterpanel-accordion").accordion("option","active",i.visIndex),PV._filterCategory(a.eq(0)),e()})}else $(".pv-filterpanel-accordion").accordion("option","collapsible",!0),$(".pv-filterpanel-accordion").accordion("option","active",!1)}else clearSearch()}),$("#pv-filterpanel-search-clear").click(function(e){$(".pv-filterpanel-search").val(""),$(".pv-toolbarpanel-sort").attr("dirty",1),$("#pv-long-search-cat").attr("dirty",1),$("#pv-filterpanel-search-clear").css("visibility","hidden"),$(".pv-filterpanel-accordion").accordion("option","collapsible",!1),$(".pv-facet[visible='visible']").show()});var clearSearch=function(){$(".pv-facet[visible='visible']").show(),$(".pv-toolbarpanel-sort").attr("dirty",1),$("#pv-long-search-cat").attr("dirty",1),$(".pv-filterpanel-accordion").accordion("option","collapsible",!1),$("#pv-filterpanel-search-clear").css("visibility","hidden")},delay=function(){var e=0;return function(t,a){clearTimeout(e),e=setTimeout(t,a)}}(),canvas=$(".pv-canvas");if($.subscribe("/PivotViewer/ImageController/Selected",function(e){_tooltip_item=e}),$.subscribe("/PivotViewer/ImageController/TooltipEnable",function(e){(_tooltip_enable=e)||$("div.tooltip").hide()}),$('<div class="tooltip"></div>').appendTo("body"),$("div.tooltip").hide(),canvas.on("mousemove",function(e){clearTimeout(timeout),$("div.tooltip").hide(),_tooltip_enable&&(timeout=setTimeout(function(){if(null!=_tooltip_item&&_tooltip_item.isSelected()){var t=e.pageX+10,a=e.pageY-20,i=$("div.tooltip"),l=document.createElement("textarea");l.innerHTML=_tooltip_item.item.name,i.text(l.value),i.css({position:"absolute",color:"white",background:"grey","border-radius":5,padding:5,border:1,top:a,left:t,"z-index":999}),i.show(),
t+i[0].clientWidth>$(".pv-canvas")[0].offsetWidth&&i.css({left:t-i[0].clientWidth})}},750))}),canvas.mouseup(function(e){if(1!=e.which)return!1;if(!_mouseMove||0==_mouseMove.x&&0==_mouseMove.y){var t=$(this).offset();PV.getCurrentView().handleClick({x:e.pageX-t.left,y:e.pageY-t.top})}_mouseDrag=null,_mouseMove=!1}),canvas.dblclick(function(e){if(options.gallery.enabled){var t=$(this).offset(),a=PV.getCurrentView().handleDoubleClick({x:e.pageX-t.left,y:e.pageY-t.top});if(null!=a){for(var i=[],l=0;l<_filterList.length;l++)i.push(_filterList[l].item);PV._viewInPhotoswipe(a.item,i,i)}}}),canvas.mouseout(function(e){_mouseDrag=null,_mouseMove=!1}),canvas.mousedown(function(e){if(1!=e.which)return!1;var t=$(this).offset(),a=e.pageX-t.left,i=e.pageY-t.top;_mouseDrag={x:a,y:i}}),canvas.mousemove(function(e){var t=$(this).offset(),a=e.pageX-t.left,i=e.pageY-t.top;null==_mouseDrag?PV.getCurrentView().handleHover({x:a,y:i}):(_mouseMove={x:a-_mouseDrag.x,y:i-_mouseDrag.y},_mouseDrag={x:a,y:i},$.publish("/PivotViewer/Views/Canvas/Drag",[_mouseMove]))}),canvas.on("mousewheel",function(e,t){var a=$(this).offset();TileController.setQuarticEasingOut();var i=$(".pv-toolbarpanel-zoomslider").slider("option","value");t>0?i=i<5?5:i+5:t<0&&(i-=5),i=Math.max(0,Math.min(100,i)),PV.zoom(i,e.pageX-a.left,e.pageY-a.top)}),canvas.on("contextmenu",function(e){var t=$(this).offset();PV.getCurrentView().handleContextMenu({x:e.pageX-t.left,y:e.pageY-t.top})}),canvas.on("touchstart",function(e){var t=e.originalEvent,a=$(this).offset();_mouseDrag={x:t.touches[0].pageX-a.left,y:t.touches[0].pageY-a.top}}),canvas.on("touchmove",function(e){try{var t=e.originalEvent;if(e.preventDefault(),t.touches.length>1){e.preventDefault();for(var a=1e7,i=1e7,l=0,n=0,o=0;o<t.touches.length;o++)t.touches[o].pageX<a&&(a=t.touches[o].pageX),t.touches[o].pageX>l&&(l=t.touches[o].pageX),t.touches[o].pageY<i&&(i=t.touches[o].pageY),t.touches[o].pageY>n&&(n=t.touches[o].pageY);var r=(a+l)/2,s=(i+n)/2;return TileController.setLinearEasingBoth(),void $.publish("/PivotViewer/Views/Canvas/Zoom",[{x:r,y:s,scale:t.scale}])}var v=$(this).offset(),c=t.touches[0].pageX-v.left,p=t.touches[0].pageY-v.top;_mouseMove={x:c-_mouseDrag.x,y:p-_mouseDrag.y},_mouseDrag={x:c,y:p},$.publish("/PivotViewer/Views/Canvas/Drag",[_mouseMove])}catch(e){Debug.log(e.message)}}),canvas.on("touchend",function(e){var t=e.originalEvent;if(1==t.touches.length&&null==_mouseDrag){var a=$(this).offset(),i=t.touches[0].pageX-a.left,l=t.touches[0].pageY-a.top;(!_mouseMove||0==_mouseMove.x&&0==_mouseMove.y)&&PV.getCurrentView().handleClick({x:i,y:l})}_mouseDrag=null,_mouseMove=!1}),_options.parameter){var para=_options.parameter;para.view&&(_options.View=para.view)}_sortCategory=$("#pv-primsort option").eq(0).html(),1==_options.authoring&&(PARA.x_axis=_sortCategory);var category=PivotCollection.getCategoryByName(_sortCategory);category.uiInit||PV.initUICategory(category),LoadSem.acquire(function(e){_tiles.sort(tileSortBy(_sortCategory,!1,_stringFilters));for(var t=0;t<_tiles.length;t++){var a=_tiles[t];a.missing=!Settings.showMissing&&void 0==a.item.getFacetByName(_sortCategory)}if(PV.filterCollection(),Settings.visibleCategories.length<PivotCollection.categories.length?$.publish("/PivotViewer/Settings/Changed",[Settings]):$(".pv-facet").attr("visible","visible"),void 0!=_options.View?PV.selectView(_options.View):PV.selectView(0),TileController.beginAnimation(),window.parent.$("#modal-loading").modal("hide"),_options.parameter){var i=_options.parameter;i.x_axis&&($("#pv-primsort option[search='"+PV.cleanName(i.x_axis.toLowerCase())+"']").prop("selected",!0),$("#pv-primsort").trigger("change")),"crosstab"==i.view&&($("#pv-altsort option[search='"+PV.cleanName(i.y_axis.toLowerCase())+"']").prop("selected",!0),$("#pv-altsort").trigger("change")),-1!=i.selected_id&&(1==_options.authoring&&(PARA.selected_loc=i.selected_loc),"map"==i.view?$(".pv-viewpanel-view").promise().done(function(){setTimeout(function(){for(var e=0;e<_filterList.length;e++){if(_filterList[e].item.id==i.selected_id){$.publish("/PivotViewer/Views/Item/Selected",[{item:_filterList[e]}]);break}}},3e3)}):$(".pv-viewpanel-view").promise().done(function(){var e=_filterList.length;e*=e<100?200:e<500?5:4,setTimeout(function(){PV.getCurrentView().handleClick({type:"init",id:i.selected_id})},e)}))}if(_options.parameter){var i=_options.parameter;if(i.string_filters)for(var t=0;t<i.string_filters.length;t++)PV.presetStrFilters(i,t);if(i.num_filters)for(var t=0;t<i.num_filters.length;t++)PV.presetNumFilters(i,t)}e()}),$(window).resize(function(e){(Math.abs($(".pv-canvas").width()-_self.width())>20||$(".pv-mainpanel").height()!=$(window).height()-$(".pv-toolbarpanel").height()-30)&&delay(function(){$("#ruleModal").hasClass("in")&&$(".modal-backdrop").remove();var e=$(window).height()-$(".pv-toolbarpanel").height()-30;$(".pv-mainpanel").css("height",e+"px"),$(".pv-infopanel").css("left",$(".pv-mainpanel").offset().left+$(".pv-mainpanel").width()-205+"px").css("height",e-28+"px"),$(".pv-canvas").css("width",_self.width()),$(".pv-canvas").css("height",e);var t=$(".pv-filterpanel");t.css("height",e-13+"px"),$(".pv-filterpanel-search").css("width",t.width()-15+"px"),$(".pv-filterpanel-accordion").css("height",$(".pv-filterpanel").height()-$(".pv-filterpanel-search").height()-75-$("#pv-long-search-box").height()+"px"),$(".pv-filterpanel-accordion").accordion({icons:!1}),$(".pv-altinfopanel")&&(t.css("height",e-13+"px"),$(".pv-altinfopanel").css("left",$(".pv-mainpanel").offset().left+$(".pv-mainpanel").width()-205+"px").css("height",$(window).height()-$(".pv-toolbarpanel").height()-58+"px"));for(var a=_self.width(),i=$(".pv-mainpanel").height(),l=$(".pv-filterpanel").width()+18,n=0;n<_views.length;n++)_views[n]instanceof PivotViewer.Views.IPivotViewerView&&_views[n].setup(a,i,l,4,TileController.getMaxTileRatio());_views[_currentView].activate(),PV.filterCollection()},300)})}),PV.presetNumFilters=function(e,t){setTimeout(function(){var a=e.num_filters[t];$(".pv-facet[aria-controls='pv-cat-"+PV.cleanName(a.facet)+"']").trigger("click"),$("#pv-cat-"+PV.cleanName(a.facet)).promise().done(function(){var e=$("#pv-facet-numericslider-"+PivotViewer.Utils.escapeMetaChars(PV.cleanName(a.facet)));PV.dragCategorySlider(e,a.selectedMin,a.selectedMax,!0)})},10)},PV.presetStrFilters=function(e,t){setTimeout(function(){$(".pv-facet[aria-controls='pv-cat-"+PV.cleanName(e.string_filters[t].facet)+"']").trigger("click");var a=_listObj[PV.cleanName(e.string_filters[t].facet)];a.size();a.update();for(var i in e.string_filters[t].value)PV.setStrFilterValues(e,i,t);a.update()},500)},PV.setStrFilterValues=function(e,t,a){PV.cleanName(e.string_filters[a].facet);$(".pv-facet-value[itemvalue='"+PV.cleanName(e.string_filters[a].value[t])+"'][itemfacet='"+PV.cleanName(e.string_filters[a].facet)+"']").trigger("click")};var oldValue=0;PV.zoom=function(e,t,a){e>100&&(e=100),void 0==t&&(t=$(".pv-canvas").width()/2),void 0==a&&(a=$(".pv-canvas").height()/2),$(".pv-toolbarpanel-zoomslider").slider("option","value",e),$.publish("/PivotViewer/Views/Canvas/Zoom",[{x:t,y:a,delta:.5*(e-oldValue)}]),oldValue=e},PV._initAllSelect=function(e,t){void 0==t&&(t="");for(var a=$(e),i=0;i<a.length;i++){var l=a.eq(i).val();a.eq(i).children().remove();for(var n=0;n<PivotCollection.categories.length;n++){var o=PivotCollection.categories[n];n!=l&&-1==o.name.toLowerCase().indexOf(t)||a.eq(i).append("<option value="+n+" search='"+PV.cleanName(o.name.toLowerCase())+"'>"+o.name+"</option>")}a.eq(i).val(l)}},PV._initAllVisible=function(e,t){void 0==t&&(t="");for(var a=$(e),i=0;i<a.length;i++){var l=a.eq(i).val();a.eq(i).children().remove();for(var n=0;n<PivotCollection.categories.length;n++){var o=PivotCollection.categories[n];n!=l&&-1==o.name.toLowerCase().indexOf(t)||a.eq(i).append("<option value="+n+" search='"+PV.cleanName(o.name.toLowerCase())+"'>"+o.name+"</option>")}a.eq(i).val(l)}},PV._initVisibleSelect=function(e,t,a){void 0==a&&(a=""),void 0==t&&(t=!1);for(var i=$(e),l=0;l<i.length;l++){var n=i.eq(l).val();i.eq(l).children().remove();for(var o=0;o<Settings.visibleCategories.length;o++){var r=Settings.visibleCategories[o],s=PivotCollection.categories[r];!(s.isFilterVisible&&!s.isLongString()||t)||r!=n&&-1==PV.cleanName(s.name).toLowerCase().indexOf(a)||i.eq(l).append("<option value="+Settings.visibleCategories[o]+" search='"+PV.cleanName(s.name.toLowerCase())+"'>"+s.name+"</option>")}i.eq(l).val(n)}},$.subscribe("/PivotViewer/Views/Item/PopViewer",function(e){PV._viewInGridView(e.item,e.near,e.all)}),PV._viewInGridView=function(e,t,a){PV.selectView("grid"),setTimeout(function(){e.setSelected(!0),_views[_currentView].centerOnTile(e),$.publish("/PivotViewer/Views/Item/Selected",[{item:e}])},1500)},$.subscribe("/PivotViewer/Views/Item/Selected",function(e){if(void 0===e.item||null==e.item)return PV.deselectInfoPanel(),null!=_selectedItem&&_selectedItem.setSelected(!1),_views[_currentView].setSelected(null),void(1==_options.authoring&&(PARA.selected_id=-1,PARA.selected_loc=-1));var t=e.item;if(1==_options.authoring&&(PARA.selected_id=e.item.item.id,PARA.selected_image=_options.imageBase+e.item.item.img+"_files/8/0_0."+_options.imageFormat),null!=t){var a=!0;$(".pv-infopanel-heading").empty(),""==t.item.href?$(".pv-infopanel-heading").append('<a target="_blank">'+t.item.name+"</a></div>"):$(".pv-infopanel-heading").append('<a href="'+t.item.href+'" target="_blank">'+t.item.name+"</a></div>");var i=$(".pv-infopanel-details");i.empty(),void 0!=t.item.description&&t.item.description.length>0&&i.append("<div class='pv-infopanel-detail-description' style='height:100px;'>"+t.item.description+"</div><div class='pv-infopanel-detail-description-more'>More</div>"),t.item.id==_filterList[0].id?($(".pv-infopanel-controls-navleft").hide(),$(".pv-infopanel-controls-navleftdisabled").show()):($(".pv-infopanel-controls-navleft").show(),$(".pv-infopanel-controls-navleftdisabled").hide()),t.item.id==_filterList[_filterList.length-1].id?($(".pv-infopanel-controls-navright").hide(),$(".pv-infopanel-controls-navrightdisabled").show()):($(".pv-infopanel-controls-navright").show(),$(".pv-infopanel-controls-navrightdisabled").hide());for(var l=[],n=Loader.getRow(t.item.id),o=0;o<n.length;o++){var r=PivotCollection.getCategoryByName(n[o].name);if(Settings.visibleCategories[r.name]){l[o]="<div class='pv-infopanel-detail "+(a?"detail-dark":"detail-light")+"'><div class='pv-infopanel-detail-item detail-item-title' pv-detail-item-title='"+r.name+"'>"+r.name+"</div>";for(var s=0;s<n[o].values.length;s++){var v=n[o].values[s];l[o]+="<div pv-detail-item-value='"+v.value+"' class='pv-infopanel-detail-item detail-item-value"+(r.isFilterVisible?" detail-item-value-filter":"")+"'>",null!=v.href&&""!=v.href?l[o]+="<a class='detail-item-link' href='"+v.href+"' target='_blank'>"+v.label+"</a>":l[o]+=v.label,l[o]+="</div>"}l[o]+="</div>",a=!a}}if(t.item.links.length>0){$(".pv-infopanel-related").empty();for(var c=0;c<t.item.links.length;c++)$(".pv-infopanel-related").append("<a href='"+t.item.links[c].href+"'>"+t.item.links[c].name+"</a><br>")}i.append(l.join("")),$(".pv-infopanel").fadeIn(),i.css("height",$(".pv-infopanel").height()-($(".pv-infopanel-controls").height()+$(".pv-infopanel-heading").height()+$(".pv-infopanel-copyright").height()+$(".pv-infopanel-related").height())-20+"px"),null!=_selectedItem&&_selectedItem.setSelected(!1),t.setSelected(!0),_selectedItem=t,_views[_currentView].setSelected(_selectedItem)}}),$.subscribe("/PivotViewer/Views/Item/Filtered",function(e){if(void 0!=e&&null!=e){for(var t=void 0!=e.length?e:[e],a=0;a<t.length;a++){var i=t[a],l=PivotCollection.getCategoryByName(i.category);l.uiInit||(PV.initUICategory(l),l.isNumber()?PV._refreshNumberWidget(l,_numericItemTotals[l.name].values):l.isOrdinal()&&PV._refreshOrdinalWidget(l,_ordinalItemTotals[l.name].values)),LoadSem.acquire(function(e){if(l.isString()||l.isLocation()){var a=_listObj[PV.cleanName(l.name)];a.size();if(a.update(),$(".pv-facet-value[itemfacet='"+PV.cleanName(l.name)+"']").prop("checked",!1),i.values){if(1==i.values.length){var n=$(PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(l.name)+"__"+PV.cleanName(i.values[0].toString()))+" input");n.prop("checked",!0),1==t.length&&PV.clickValue(n[0])}else if(i.values.length>0){for(var o=0;o<i.values.length;o++)$(PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(l.name)+"__"+PV.cleanName(i.values[o].toString()))+" input").prop("checked",!0);$(PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(l.name)+"__"+PV.cleanName(i.values[0].toString()))+" input").parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible"),1==t.length&&PV.filterCollection()}}else{var n=$(PivotViewer.Utils.escapeMetaChars("#pv-facet-value-"+PV.cleanName(l.name)+"__"+PV.cleanName(i.min.toString()))+" input");n.prop("checked",!0),1==t.length&&PV.clickValue(n[0])}a.update()}else if(l.isNumber()||l.isOrdinal()){var r=$("#pv-facet-numericslider-"+PivotViewer.Utils.escapeMetaChars(PV.cleanName(l.name)));void 0==i.max&&(i.max=i.min),PV.dragCategorySlider(r,i.min,i.max,1==t.length)}else if(l.isDateTime()){var s=PV.cleanName(l.name);$("#pv-facet-value-"+s+"__CustomRange:first-child").prop("checked",!0),PV._getCustomDateRange(s);var v=$("#pv-custom-range-"+s+"__StartDate"),c=$("#pv-custom-range-"+s+"__FinishDate"),p=new Date(i.min),u=new Date(i.max);v[0].value=p.getMonth()+1+"/"+p.getDate()+"/"+p.getFullYear(),c[0].value=u.getMonth()+1+"/"+u.getDate()+"/"+u.getFullYear(),v.datepicker("option","minDate",p),c.datepicker("option","maxDate",u);var d=$(v).parent().parent().parent().parent().children().next().find(".pv-facet-value:checked");d.find("[itemvalue!='CustomRange']").prop("checked",!1),d.parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible"),1==t.length&&PV.filterCollection()}e()})}t.length>1&&PV.filterCollection()}}),PV.clickValue=function(e){var t,a,i=PivotCollection.getCategoryByName(_nameMapping[$(e).attr("itemfacet")]),l=_listObj[$(e).attr("itemfacet")],n=_nameMapping[$(e).attr("itemvalue")];if($(e).prop("checked")){if($(e).parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible"),"CustomRange"==$(e).attr("itemvalue"))return void PV._getCustomDateRange($(e).attr("itemfacet"));if(i.isDateTime())t=$("input[itemfacet|='"+$(e).attr("itemfacet")+"']:checked").length>1;else{for(var o=0,r=0;r<l.items.length;r++)1==l.items[r].elm.childNodes[0].checked&&(o+=1);t=o>1}a=!1}else if(!$(e).prop("checked")){"CustomRange"==$(e).attr("itemvalue")&&PV._hideCustomDateRange($(e).attr("itemfacet"));var o=0;if(i.isDateTime())o=$("input[itemfacet|='"+$(e).attr("itemfacet")+"']:checked").length;else for(var r=0;r<l.items.length;r++)1==l.items[r].elm.childNodes[0].checked&&(o+=1);if(0==o)return t=!0,$(e).parent().parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").trigger("click"),void(a=!0);t=!1,a=!1}i.isString()||i.isLocation()?PV.filterCollection({category:i,enlarge:t,clear:a,value:n,listPage:l}):(start=$(e).attr("startdate"),end=$(e).attr("enddate"),PV.filterCollection({category:i,enlarge:t,clear:a,value:n,min:new Date(start),max:new Date(end)}))},PV.dragCategorySlider=function(e,t,a,i){var l=$(e),n=l.modSlider("option","min"),o=l.modSlider("option","max");"(no info)"==t&&(t=0),t>n||a<o?(l.parent().find(".pv-facet-numericslider-range-val").text(t+" - "+a),l.modSlider("values",0,t),l.modSlider("values",1,a),l.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","visible")):t==n&&a==o&&l.parent().parent().prev().find(".pv-filterpanel-accordion-heading-clear").css("visibility","hidden"),0!=i&&PV.filterCollection()},PV._bucketize=function(e,t,a,i,l){void 0==e[t]&&(e[t]=[]);var n=e[t],o=n[a+"a"];void 0!=o?(o.items[i+"a"]=i,o.items.push(i),o.start>l?o.start=l:o.end<l&&(o.end=l)):(o=new PivotViewer.Models.DateTimeInfo(a,l,l),o.items[i+"a"]=i,o.items.push(i),n.push(o),n[a+"a"]=o)},PV._createDatetimeBuckets=function(e){for(var t=new Date(864e13),a=new Date(-864e13),i=!1,l=!1,n=!1,o=0;o<PivotCollection.items.length;o++){var r=PivotCollection.items[o],s=r.getFacetByName(e.name);if(void 0!=s){var v=new Date(s.values[0].value);v<t&&(t=v),v>a&&(a=v),0!=v.getHours()&&(i=!0),0!=v.getMinutes()&&(l=!0),0!=v.getSeconds()&&(n=!0)}}for(var c=a.getFullYear()-t.getFullYear()+t.getFullYear()%10>9,p=a.getFullYear()>t.getFullYear(),u=p||a.getMonth()>t.getMonth(),d=u||a.getDate()>t.getDate(),o=0;o<PivotCollection.items.length;o++){var r=PivotCollection.items[o],s=r.getFacetByName(e.name);if(void 0!=s){var v=new Date(s.values[0].value),m=0,g=v.getFullYear(),f=g-g%10;c&&PV._bucketize(e.datetimeBuckets,m++,f+"s",r.id,v),p&&PV._bucketize(e.datetimeBuckets,m++,g,r.id,v);var h=PivotViewer.Utils.getMonthName(v);u&&PV._bucketize(e.datetimeBuckets,m++,h+", "+g,r.id,v);var b=v.getDate();d&&PV._bucketize(e.datetimeBuckets,m++,h+" "+b+", "+g,r.id,v);var _=PivotViewer.Utils.getHour(v),P=PivotViewer.Utils.getMeridian(v);i&&PV._bucketize(e.datetimeBuckets,m++,h+" "+b+", "+g+" "+_+" "+P,r.id,v);var $=PivotViewer.Utils.getMinutes(v);l&&PV._bucketize(e.datetimeBuckets,m++,h+" "+b+", "+g+" "+_+":"+$+" "+P,r.id,v);var V=PivotViewer.Utils.getSeconds(v);n&&PV._bucketize(e.datetimeBuckets,m,h+" "+b+", "+g+" "+_+":"+$+":"+V+" "+P,r.id,v)}}for(var o=0;o<e.datetimeBuckets.length;o++)e.datetimeBuckets[o].sort(function(e,t){return e.start-t.start});var m=0;c&&(e.datetimeBuckets.decade=e.datetimeBuckets[m++]),p&&(e.datetimeBuckets.year=e.datetimeBuckets[m++]),u&&(e.datetimeBuckets.month=e.datetimeBuckets[m++]),d&&(e.datetimeBuckets.day=e.datetimeBuckets[m++]),i&&(e.datetimeBuckets.hour=e.datetimeBuckets[m++]),l&&(e.datetimeBuckets.minute=e.datetimeBuckets[m++]),n&&(e.datetimeBuckets.second=e.datetimeBuckets[m])},PV._hideCustomDateRange=function(e){$("#pv-custom-range-"+e+"__Start").css("visibility","hidden"),$("#pv-custom-range-"+e+"__Finish").css("visibility","hidden"),$("#pv-custom-range-"+e+"__StartDate").datepicker("setDate",null),$("#pv-custom-range-"+e+"__FinishDate").datepicker("setDate",null),$("#pv-custom-range-"+e+"__FinishDate").datepicker("option","minDate",null),$("#pv-custom-range-"+e+"__StartDate").datepicker("option","minDate",null),$("#pv-custom-range-"+e+"__FinishDate").datepicker("option","maxDate",null),$("#pv-custom-range-"+e+"__StartDate").datepicker("option","maxDate",null)},PV._getCustomDateRange=function(e){var t,a,i,l,n=_nameMapping[e],o=PivotCollection.getCategoryByName(n);$("#pv-custom-range-"+e+"__Start").css("visibility","visible"),$("#pv-custom-range-"+e+"__Finish").css("visibility","visible"),$("#pv-custom-range-"+e+"__StartDate").datepicker({showOn:"button",changeMonth:!0,changeYear:!0,buttonText:"Show Date",buttonImageOnly:!0,buttonImage:"http://jqueryui.com/resources/demos/datepicker/images/calendar.gif"}),$("#pv-custom-range-"+e+"__FinishDate").datepicker({showOn:"button",changeMonth:!0,changeYear:!0,buttonText:"Show Date",buttonImageOnly:!0,buttonImage:"http://jqueryui.com/resources/demos/datepicker/images/calendar.gif"}),void 0!=o.datetimeBuckets.day&&o.datetimeBuckets.day.length>0&&(i=o.datetimeBuckets.day[o.datetimeBuckets.day.length-1].start,l=o.datetimeBuckets.day[0].start,$("#pv-custom-range-"+e+"__StartDate").datepicker("option","defaultDate",l),$("#pv-custom-range-"+e+"__FinishDate").datepicker("option","defaultDate",i),void 0!=o.datetimeBuckets.year&&o.datetimeBuckets.year.length>0&&(t=o.datetimeBuckets.year[o.datetimeBuckets.year.length-1].name,a=o.datetimeBuckets.year[0].name,$("#pv-custom-range-"+e+"__StartDate").datepicker("option","yearRange",a+":"+t),$("#pv-custom-range-"+e+"__FinishDate").datepicker("option","yearRange",a+":"+t)))},PV._changeCustomRange=function(e){var t,a;if("CustomRangeStart"==$(e).attr("itemvalue")?(t=$(e)[0].value,""==(a=$("#pv-custom-range-"+$(e).attr("itemfacet")+"__FinishDate")[0].value)&&$("#pv-custom-range-"+$(e).attr("itemfacet")+"__FinishDate").datepicker("option","minDate",new Date(t))):"CustomRangeFinish"==$(e).attr("itemvalue")&&(a=$(e)[0].value,""==(t=$("#pv-custom-range-"+$(e).attr("itemfacet")+"__StartDate")[0].value)&&$("#pv-custom-range-"+$(e).attr("itemfacet")+"__StartDate").datepicker("option","maxDate",new Date(a))),t&&a){for(var i=$(e).parent().parent().parent().parent().children().next().find(".pv-facet-value:checked"),l=0;l<i.length;l++)"CustomRange"!=$(i[l]).attr("itemvalue")&&$(i[l]).prop("checked",!1);PV.filterCollection()}},$.fn.PivotViewer=function(e){return methods[e]?methods[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void $.error("Method "+e+" does not exist on jQuery.PivotViewer"):methods.init.apply(this,arguments)}}(jQuery);