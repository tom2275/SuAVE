PivotViewer.Models.Loaders.JSONLoader=PivotViewer.Models.Loaders.ICollectionLoader.subClass({init:function(e,t){this.JSONUriNoProxy=e,this.JSONUri=t?t+e:e},LoadCollection:function(e){var e=e;this._super(e),e.CollectionBaseNoProxy=this.JSONUriNoProxy,e.CollectionBase=this.JSONUri;$.getJSON(this.JSONUri).done(function(t){if(Debug.Log("JSON loaded"),void 0==t.FacetCategories||void 0==t.Items){$(".pv-loading").remove();c="";c+="Error parsing CXML Collection<br>",c+="<br>SuAVE cannot continue until this problem is resolved<br>",$(".pv-wrapper").append('<div id="pv-parse-error" class="pv-modal-dialog"><div><a href="#pv-modal-dialog-close" title="Close" class="pv-modal-dialog-close">X</a><h2>HTML5 PivotViewer</h2><p>'+c+"</p></div></div>");setTimeout(function(){window.open("#pv-parse-error","_self")},1e3);throw"Error parsing CXML Collection"}void 0!=t.CollectionName&&(e.CollectionName=t.CollectionName),void 0!=t.BrandImage&&(e.BrandImage=t.BrandImage);for(i=0;i<t.FacetCategories.FacetCategory.length;i++){var a=new PivotViewer.Models.FacetCategory(t.FacetCategories.FacetCategory[i].Name,t.FacetCategories.FacetCategory[i].Format,t.FacetCategories.FacetCategory[i].Type,void 0==t.FacetCategories.FacetCategory[i].IsFilterVisible||"true"==t.FacetCategories.FacetCategory[i].IsFilterVisible.toLowerCase(),void 0==t.FacetCategories.FacetCategory[i].IsMetadataVisible||"true"==t.FacetCategories.FacetCategory[i].IsMetadataVisible.toLowerCase(),void 0==t.FacetCategories.FacetCategory[i].IsWordWheelVisible||"true"==t.FacetCategories.FacetCategory[i].IsWordWheelVisible.toLowerCase());if(void 0!=t.FacetCategories.FacetCategory[i].SortOrder){var o=new PivotViewer.Models.FacetCategorySort(t.FacetCategories.FacetCategory[i].SortOrder.Name);for(j=0;j<t.FacetCategories.FacetCategory[i].SortValues.Value.length;J++)o.Values.push(t.FacetCategories.FacetCategory[i].SortValues.Value[j]);a.CustomSort=o}e.FacetCategories.push(a)}if(void 0!=t.Items.ImgBase&&(e.ImageBase=t.Items.ImgBase),0==t.Items.Item.length){$(".pv-loading").remove();c="";c+="There are no items in the CXML Collection<br><br>",$(".pv-wrapper").append('<div id="pv-empty-collection-error" class="pv-modal-dialog"><div><a href="#pv-modal-dialog-close" title="Close" class="pv-modal-dialog-close">X</a><h2>HTML5 PivotViewer</h2><p>'+c+"</p></div></div>");setTimeout(function(){window.open("#pv-empty-collection-error","_self")},1e3)}else for(var i=0;i<t.Items.Item.length;i++){var s=new PivotViewer.Models.Item(t.Items.Item[i].Img.replace("#",""),t.Items.Item[i].Id,t.Items.Item[i].Href,t.Items.Item[i].Name);for(s.Description=PivotViewer.Utils.HtmlSpecialChars(t.Items.Item[i].Description),j=0;j<t.Items.Item[i].Facets.Facet.length;j++){var r=[];if(void 0!=t.Items.Item[i].Facets.Facet[j].Number)if(t.Items.Item[i].Facets.Facet[j].Number.length>0)for(k=0;k<t.Items.Item[i].Facets.Facet[j].Number.length;k++){l=new PivotViewer.Models.FacetValue(parseFloat(t.Items.Item[i].Facets.Facet[j].Number[k].Value));r.push(l)}else{l=new PivotViewer.Models.FacetValue(parseFloat(t.Items.Item[i].Facets.Facet[j].Number.Value));r.push(l)}else if(void 0!=t.Items.Item[i].Facets.Facet[j].Link)for(k=0;k<t.Items.Item[i].Facets.Facet[j].Link.length;k++)(l=new PivotViewer.Models.FacetValue(t.Items.Item[i].Facets.Facet[j].Link[k].Name)).Href=t.Items.Item[i].Facets.Facet[j].Link[k].Href,r.push(l);else if(void 0!=t.Items.Item[i].Facets.Facet[j].String)if(t.Items.Item[i].Facets.Facet[j].String.length>0)for(k=0;k<t.Items.Item[i].Facets.Facet[j].String.length;k++){l=new PivotViewer.Models.FacetValue(t.Items.Item[i].Facets.Facet[j].String[k].Value);r.push(l)}else{l=new PivotViewer.Models.FacetValue(t.Items.Item[i].Facets.Facet[j].String.Value);r.push(l)}else if(void 0!=t.Items.Item[i].Facets.Facet[j].LongString)if(t.Items.Item[i].Facets.Facet[j].LongString.length>0)for(k=0;k<t.Items.Item[i].Facets.Facet[j].LongString.length;k++){l=new PivotViewer.Models.FacetValue(t.Items.Item[i].Facets.Facet[j].LongString[k].Value);r.push(l)}else{l=new PivotViewer.Models.FacetValue(t.Items.Item[i].Facets.Facet[j].LongString.Value);r.push(l)}else if(void 0!=t.Items.Item[i].Facets.Facet[j].DateTime)if(t.Items.Item[i].Facets.Facet[j].DateTime.length>0)for(k=0;k<t.Items.Item[i].Facets.Facet[j].DateTime.length;k++){l=new PivotViewer.Models.FacetValue(t.Items.Item[i].Facets.Facet[j].DateTime[k].Value);r.push(l)}else{var l=new PivotViewer.Models.FacetValue(t.Items.Item[i].Facets.Facet[j].DateTime.Value);r.push(l)}else{$(".pv-loading").remove();var c="";c+="Error parsing the CXML Collection:<br>Unrecognised facet value type<br>",$(".pv-wrapper").append('<div id="pv-parse-error" class="pv-modal-dialog"><div><a href="#pv-modal-dialog-close" title="Close" class="pv-modal-dialog-close">X</a><h2>HTML5 PivotViewer</h2><p>'+c+"</p></div></div>");setTimeout(function(){window.open("#pv-parse-error","_self")},1e3)}var n=new PivotViewer.Models.Facet(t.Items.Item[i].Facets.Facet[j].Name,r);s.Facets.push(n)}void 0!=t.Items.Item[i].Extension&&void 0!=t.Items.Item[i].Extension.Related&&(s.Links=t.Items.Item[i].Extension.Related.Link),e.Items.push(s)}void 0!=t.Extension&&void 0!=t.Extension.Copyright&&(e.CopyrightName=t.Extension.Copyright.Name,e.CopyrightHref=t.Extension.Copyright.Href),t.Items.Item.length>0&&$.publish("/PivotViewer/Models/Collection/Loaded",null)}).fail(function(e,t,a){$(".pv-loading").remove();var o="";o=(o=(o=(o+="Error loading CXML Collection<br><br>")+"URL        : "+this.url+"<br>")+"Status : "+e.status+" "+a+"<br>")+"Details    : "+e.responseText+"<br>",o+="<br>SuAVE cannot continue until this problem is resolved<br>",$(".pv-wrapper").append('<div id="pv-loading-error" class="pv-modal-dialog"><div><a href="#pv-modal-dialog-close" title="Close" class="pv-modal-dialog-close">X</a><h2>HTML5 PivotViewer</h2><p>'+o+"</p></div></div>");setTimeout(function(){window.open("#pv-loading-error","_self")},1e3)})}});